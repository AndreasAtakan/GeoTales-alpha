{"mappings":"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","sources":["edit/js/main.js","edit/js/helpers.js","edit/js/generate.js","edit/js/scenes.js","edit/js/textboxes.js","edit/js/map/map.js","edit/js/map/layers.js"],"sourcesContent":["/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport {\n\timport_data,\n\texport_data,\n\tsave_data,\n\tunsaved_changes,\n\tinit_basemaps\n} from \"./helpers.js\";\n\nimport { Scenes } from \"./scenes.js\";\nimport { Textboxes } from \"./textboxes.js\";\n\nimport \"./map/map.js\";\n\n\nwindow.onload = function(ev) {\n\n\t// Disable mobile pinch-zoom\n\tdocument.addEventListener(\"touchmove\", function(ev) {\n\t\tif(ev.scale !== 1) { ev.preventDefault(); }\n\t}, false);\n\n\t// Set up window resize start/end events\n\tlet resizeTimer = false;\n\t$(window).on(\"resize\", function(ev) {\n\t\tif( !resizeTimer ) { $(window).trigger(\"resizestart\"); }\n\t\tclearTimeout(resizeTimer);\n\t\tresizeTimer = setTimeout(function() {\n\t\t\tresizeTimer = false;\n\t\t\t$(window).trigger(\"resizeend\");\n\t\t}, 250);\n\t}).on(\"resizeend\", function() { _MAP.setAspectRatio(); });\n\n\n\n\t_SCENES = new Scenes();\n\n\t$(\"#sceneRow\").keydown(ev => { if([\"ArrowUp\", \"ArrowDown\", \"ArrowRight\", \"ArrowLeft\", \"Space\"].indexOf(ev.code) > -1) { ev.preventDefault(); } });\n\t$(\"#sceneRow\").keyup(ev => {\n\t\tlet keycode = ev.code;\n\t\tif(keycode == \"ArrowLeft\") { ev.preventDefault(); _SCENES.prev(); }\n\t\tif(keycode == \"ArrowRight\") { ev.preventDefault(); _SCENES.next(); }\n\t\tif([\"ArrowUp\", \"ArrowDown\", \"ArrowRight\", \"ArrowLeft\", \"Space\"].indexOf(keycode) > -1) { ev.preventDefault(); }\n\t});\n\n\t$(\"#sceneRow button#add\").click(ev => { _SCENES.add(); });\n\t$(\"#sceneRow button#recapture\").click(ev => { _SCENES.capture(); });\n\t$(\"#sceneWarningModal button#delete\").click(ev => { _SCENES.delete(); $(\"#sceneWarningModal\").modal(\"hide\"); });\n\n\n\t_TEXTBOXES = new Textboxes();\n\n\n\t_MAP = L.map(\"map\", {\n\t\tcenter: [ 49, 14 ],\n\t\tzoom: window.innerWidth < 575.98 ? 3 : 5,\n\t\tzoomControl: false,\n\t\tmaxZoom: 18,\n\t\tdoubleClickZoom: false,\n\t\tzoomAnimationThreshold: 100,\n\t\twheelPxPerZoomLevel: 1500,\n\t\tkeyboard: false,\n\t\ttap: false,\n\t\tboxZoom: false,\n\t\t//touchZoom: false,\n\t\t//worldCopyJump: true\n\n\t\tcontextmenu: true,\n\t\tcontextmenuItems: [\n\t\t\t{ text: \"Copy coordinates\", callback: ev => { navigator.clipboard.writeText( `${ev.latlng.lat}, ${ev.latlng.lng}` ); } },\n\t\t\t{ text: \"Center map here\", callback: ev => { _MAP.panTo(ev.latlng); } },\n\t\t\t\"-\",\n\t\t\t{ text: \"Zoom in\", icon: \"assets/zoom-in.png\", callback: ev => { _MAP.zoomIn(); } },\n\t\t\t{ text: \"Zoom out\", icon: \"assets/zoom-out.png\", callback: ev => { _MAP.zoomOut(); } }\n\t\t]\n\t});\n\n\tdocument.addEventListener(\"_setup\", ev => {\n\t\t_MAP.setup(); _TEXTBOXES.setup(); _SCENES.setup();\n\t});\n\tdocument.addEventListener(\"_reset\", ev => {\n\t\t_SCENES.reset(); _TEXTBOXES.reset(); _MAP.reset();\n\t});\n\n\n\n\t$(\"#optionsModal input#animationSpeed\").change(function(ev) { _OPTIONS.animationspeed = $(this).val() * 1000; });\n\t$(\"#optionsModal input#panningSpeed\").change(function(ev) { _OPTIONS.panningspeed = $(this).val() || null; });\n\t$(\"#optionsModal select#aspectRatio\").change(function(ev) { _MAP.setAspectRatio( eval( this.value ) ); });\n\t$(\"#optionsModal input#objectsOptIn\").change(function(ev) { _OPTIONS.objectOptIn = this.checked; });\n\n\n\n\tinit_basemaps();\n\n\t$(\"#basemapModal input#basemapFile\").change(ev => {\n\t\tlet file = $(ev.target)[0].files[0];\n\t\tif(!file) { return; }\n\n\t\t$(\"#loadingModal\").modal(\"show\");\n\n\t\tlet data = new FormData();\n\t\tdata.append(\"op\", \"upload_create\");\n\t\tdata.append(\"type\", \"basemap\");\n\t\tdata.append(\"image\", file);\n\n\t\t$.ajax({\n\t\t\ttype: \"POST\",\n\t\t\turl: \"api.php\",\n\t\t\tdata: data,\n\t\t\tcontentType: false,\n\t\t\tprocessData: false,\n\t\t\tsuccess: async function(result, status, xhr) {\n\t\t\t\tawait _MAP.setBasemap({ type: \"image\", img: result });\n\t\t\t\t_SCENES.setBasemap();\n\t\t\t\t_BASEMAPS.push({\n\t\t\t\t\tname: \"\",\n\t\t\t\t\ttiles: { type: \"image\", img: result },\n\t\t\t\t\tpreview: result\n\t\t\t\t});\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t\t},\n\t\t\terror: function(xhr, status, error) {\n\t\t\t\tconsole.error(xhr.status, error);\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t\t}\n\t\t});\n\t});\n\n\t$(\"#basemapModal button#basemapFetch\").click(ev => {\n\t\tlet url = $(\"#basemapModal input#basemapLink\").val();\n\t\tif(!url) { return; }\n\n\t\tlet protocol = url.split(/\\:/ig)[0];\n\t\tif(protocol == \"mapbox\") {\n\t\t\tlet username = url.split(/mapbox\\:\\/\\/styles\\//ig)[1].split(/\\//ig)[0], styleID = url.split(/mapbox\\:\\/\\/styles\\//ig)[1].split(/\\//ig)[1],\n\t\t\t\tkey = $(\"#basemapModal input#basemapKey\").val();\n\t\t\tif(!key) { return; }\n\n\t\t\turl = `https://api.mapbox.com/styles/v1/${username}/${styleID}/tiles/256/{z}/{x}/{y}?access_token=${key}`;\n\t\t}\n\n\t\t_MAP.setBasemap({ type: \"tiles\", url: url });\n\t\t_SCENES.setBasemap();\n\t});\n\n\t$(\"#basemapModal button#wmsAdd\").click(ev => {\n\t\tlet url = $(\"#basemapModal input#wmsLink\").val(),\n\t\t\tlayers = $(\"#basemapModal input#wmsLayer\").val(),\n\t\t\tformat = $(\"#basemapModal select#wmsFormat\").val(),\n\t\t\tversion = $(\"#basemapModal select#wmsVersion\").val();\n\t\tif(!url || !layers) { return; }\n\n\t\t_MAP.setWMS({\n\t\t\ttype: \"wms\",\n\t\t\turl: url,\n\t\t\tlayers: layers,\n\t\t\tformat: format,\n\t\t\tversion: version,\n\t\t\ttransparent: format == \"image/png\"\n\t\t});\n\t\t_SCENES.setWMS();\n\t});\n\t$(\"#basemapModal button#wmsRemove\").click(ev => {\n\t\t_MAP.setWMS(null);\n\t\t_SCENES.setWMS();\n\t});\n\n\n\n\t$(\"#projectFileInput\").change(ev => {\n\t\tlet file = $(ev.target)[0].files[0];\n\t\tif(!file) { return; }\n\n\t\tlet fr = new FileReader();\n\t\tfr.onload = function() { import_data( \"project\", JSON.parse( fr.result ) ); };\n\t\tfr.readAsText(file);\n\t});\n\t$(\"#geojsonImportModal button#import\").click(ev => {\n\t\t$(\"#geojsonImportModal\").modal(\"hide\");\n\n\t\tlet file = $(\"#geojsonImportModal input#fileInput\")[0].files[0];\n\t\tif(!file) { return; }\n\n\t\tlet options = {\n\t\t\tlineColor: $(\"#geojsonImportModal #lineColor\").val(),\n\t\t\tlineThickness: $(\"#geojsonImportModal #lineThickness\").val() || 3,\n\t\t\tlineTransparency: $(\"#geojsonImportModal #lineTransparency\").val(),\n\t\t\tfillColor: $(\"#geojsonImportModal #fillColor\").val(),\n\t\t\tfillTransparency: $(\"#geojsonImportModal #fillTransparency\").val() || 0.8\n\t\t};\n\n\t\tlet fr = new FileReader();\n\t\tfr.onload = function() { import_data( \"geojson\", JSON.parse( fr.result ), options ); };\n\t\tfr.readAsText(file);\n\t});\n\t$(\"#gedcomImportModal button#import\").click(ev => {\n\t\t$(\"#gedcomImportModal\").modal(\"hide\");\n\n\t\tlet file = $(\"#gedcomImportModal input#fileInput\")[0].files[0];\n\t\tif(!file) { return; }\n\n\t\tlet options = {};\n\n\t\tlet fr = new FileReader();\n\t\tfr.onload = function() { import_data( \"gedcom\", fr.result, options ); };\n\t\tfr.readAsText(file);\n\t});\n\n\n\t$(\"button#export\").click(ev => {\n\t\texport_data( $(ev.target).data(\"type\") || null );\n\t});\n\n\t$(\"a#save\").click(ev => {\n\t\t$(\"#loadingModal\").modal(\"show\");\n\t\tsave_data(function() { $(\"#loadingModal\").modal(\"hide\"); });\n\t});\n\tsetInterval(save_data, 5 * 60 * 1000);\n\n\n\t$(\"#loadingModal\").modal(\"show\");\n\t$.ajax({\n\t\ttype: \"GET\",\n\t\turl: \"api.php\",\n\t\tdata: {\n\t\t\t\"op\": \"map_read\",\n\t\t\t\"id\": _ID,\n\t\t\t\"password\": \"\"\n\t\t},\n\t\tdataType: \"json\",\n\t\tsuccess: function(result, status, xhr) {\n\t\t\tif(result.data) { import_data( \"project\", JSON.parse(result.data) ); }\n\t\t\t$(`div#sceneRow,\n\t\t\t   div#mapRow,\n\t\t\t   .navbar .navbarContent li`).click(ev => { unsaved_changes(); });\n\n\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t},\n\t\terror: function(xhr, status, error) {\n\t\t\tconsole.error(xhr.status, error);\n\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t}\n\t});\n\n\t$.ajax({\n\t\ttype: \"GET\",\n\t\turl: \"api.php\",\n\t\tdata: { \"op\": \"upload_get\" },\n\t\tdataType: \"json\",\n\t\tsuccess: function(result, status, xhr) {\n\t\t\tfor(let r of result) {\n\t\t\t\tif(r.type == \"icon\") { _ICONS.unshift(r.ref); }\n\t\t\t\telse\n\t\t\t\tif(r.type == \"basemap\") {\n\t\t\t\t\t_BASEMAPS.push({\n\t\t\t\t\t\tname: \"\",\n\t\t\t\t\t\ttiles: { type: \"image\", img: r.ref },\n\t\t\t\t\t\tpreview: r.ref\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\terror: function(xhr, status, error) {\n\t\t\tconsole.error(xhr.status, error);\n\t\t}\n\t});\n\n};\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { generate_basemaps } from \"./generate.js\";\n\n\nexport function uuid(a) {\n\treturn a ? (a^Math.random()*16>>a/4).toString(16) : ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, uuid);\n}\n\n\n\nexport function sanitize(str) {\n\tlet map = {\n\t\t\"\\&\": \"&amp;\",\n\t\t\"\\<\": \"&lt;\",\n\t\t\"\\>\": \"&gt;\",\n\t\t\"\\\"\": \"&quot;\",\n\t\t\"\\'\": \"&#x27;\",\n\t\t\"\\/\": \"&#x2F;\"\n\t};\n\tlet reg = /[&<>\"'/]/ig;\n\treturn str.replace(reg, match => (map[match]));\n}\n\n\n\nfunction import_project(data) {\n\t_OPTIONS = data.options;\n\t$(\"#optionsModal input#animationSpeed\").val(_OPTIONS.animationspeed / 1000);\n\t$(\"#optionsModal input#panningSpeed\").val(_OPTIONS.panningspeed || null);\n\t$(\"#optionsModal input#objectsOptIn\").prop(\"checked\", _OPTIONS.objectOptIn);\n\n\tif(data.scenes.length <= 0) { return; }\n\n\tif(_SCENES.store.length <= 0) { document.dispatchEvent( new Event(\"_setup\") ); }\n\n\t_SCENES.importData(data.scenes);\n\t_TEXTBOXES.importData(data.textboxes);\n\t_MAP.importData(data.objects);\n\n\t_SCENES.current();\n}\nfunction import_geojson(data, options) {\n\tfor(let f of data.features) {\n\t\tlet o;\n\t\tlet t = a => {\n\t\t\tif(Array.isArray(a[0])) { for(let v of a) { t(v); } }\n\t\t\telse{ a.reverse(); }\n\t\t};\n\t\tlet pos = f.geometry.coordinates; t(pos);\n\n\t\tif(f.properties.type == \"avatar\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\t\"avatar\",\n\t\t\t\tpos:\t\t\t\tpos,\n\t\t\t\tlabel:\t\t\t\tf.properties.label,\n\t\t\t\ticon:\t\t\t\tf.properties.icon,\n\t\t\t\tratio:\t\t\t\tf.properties.ratio,\n\t\t\t\trounded:\t\t\tf.properties.rounded,\n\t\t\t\tangle:\t\t\t\tf.properties.angle,\n\t\t\t\tborderColor:\t\tf.properties.borderColor,\n\t\t\t\tborderThickness:\tf.properties.borderThickness,\n\t\t\t\tblur:\t\t\t\tf.properties.overlayBlur,\n\t\t\t\tgrayscale:\t\t\tf.properties.overlayGrayscale,\n\t\t\t\tbrightness:\t\t\tf.properties.overlayBrightness,\n\t\t\t\ttransparency:\t\tf.properties.overlayTransparency\n\t\t\t};\n\t\t}else\n\t\tif(f.properties.type == \"polyline\"\n\t\t|| f.geometry.type == \"LineString\"\n\t\t|| f.geometry.type == \"MultiLineString\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\"polyline\",\n\t\t\t\tpos:\t\t\tpos,\n\t\t\t\tlabel:\t\t\tf.properties.label,\n\t\t\t\tdashed:\t\t\tf.properties.dashed,\n\t\t\t\tcolor:\t\t\tf.properties.color || options.lineColor,\n\t\t\t\tthickness:\t\tf.properties.thickness || options.lineThickness,\n\t\t\t\ttransparency:\tf.properties.transparency || options.lineTransparency\n\t\t\t};\n\t\t}else\n\t\tif(f.properties.type == \"polygon\"\n\t\t|| f.properties.type == \"rectangle\"\n\t\t|| f.geometry.type == \"Polygon\"\n\t\t|| f.geometry.type == \"MultiPolygon\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\t\"polygon\",\n\t\t\t\tpos:\t\t\t\tpos,\n\t\t\t\tlabel:\t\t\t\tf.properties.label,\n\t\t\t\tdashed:\t\t\t\tf.properties.dashed,\n\t\t\t\tlineColor:\t\t\tf.properties.lineColor || options.lineColor,\n\t\t\t\tlineThickness:\t\tf.properties.lineThickness || options.lineThickness,\n\t\t\t\tlineTransparency:\tf.properties.lineTransparency || options.lineTransparency,\n\t\t\t\tfillColor:\t\t\tf.properties.fillColor || options.fillColor,\n\t\t\t\tfillTransparency:\tf.properties.fillTransparency || options.fillTransparency\n\t\t\t};\n\t\t}else\n\t\tif(f.properties.type == \"circle\"\n\t\t|| f.geometry.type == \"Point\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\t\"circle\",\n\t\t\t\tpos:\t\t\t\tpos,\n\t\t\t\tradius:\t\t\t\tf.properties.radius || 4000 * (_MAP.getMaxZoom() - _MAP.getZoom()),\n\t\t\t\tlabel:\t\t\t\tf.properties.label,\n\t\t\t\tdashed:\t\t\t\tf.properties.dashed,\n\t\t\t\tlineColor:\t\t\tf.properties.lineColor || options.lineColor,\n\t\t\t\tlineThickness:\t\tf.properties.lineThickness || options.lineThickness,\n\t\t\t\tlineTransparency:\tf.properties.lineTransparency || options.lineTransparency,\n\t\t\t\tfillColor:\t\t\tf.properties.fillColor || options.fillColor,\n\t\t\t\tfillTransparency:\tf.properties.fillTransparency || options.fillTransparency\n\t\t\t};\n\t\t}\n\t\telse{ continue; }\n\n\t\tlet object = _MAP.createObject(o);\n\t\t_MAP.addLayer( object );\n\t\t_MAP.fire(\"_addedlayer\", { layer: object });\n\t\t_MAP.objects.push( _MAP.extractObject(object) );\n\t}\n}\nfunction import_gedcom(data, options) {\n\t//\n}\nexport function import_data(type, data, options) {\n\tswitch(type) {\n\t\tcase \"project\": import_project(data); break;\n\t\tcase \"geojson\": import_geojson(data, options); break;\n\t\tcase \"gedcom\": import_gedcom(data, options); break;\n\t\tdefault: console.error(\"data-import type invalid\"); break;\n\t}\n}\n\n\nfunction export_project() {\n\treturn JSON.stringify({\n\t\toptions: _OPTIONS,\n\t\tscenes: _SCENES.exportData(),\n\t\ttextboxes: _TEXTBOXES.exportData(),\n\t\tobjects: _MAP.exportData()\n\t});\n}\nfunction export_geojson() {\n\tlet r = [];\n\tfor(let o of _MAP.getLayers()) { r.push( o.__toGeoJSON() ); }\n\treturn JSON.stringify({\n\t\t\"type\": \"FeatureCollection\",\n\t\t\"features\": r\n\t});\n}\nlet running = false;\nexport function export_data(type) {\n\tif(running) { return; } running = true;\n\n\tlet el = document.createElement(\"a\");\n\n\tlet f = v => v < 10 && v >= 0 ? `0${v}` : `${v}`;\n\tlet date = new Date();\n\tlet y = date.getFullYear(), m = f(date.getMonth() + 1), d = f(date.getDate()), H = f(date.getHours()), M = f(date.getMinutes()), S = f(date.getSeconds());\n\tlet filename = `${_TITLE} - ${y}.${m}.${d} - ${H}.${M}.${S}`;\n\n\tlet data;\n\tswitch(type) {\n\t\tcase \"project\":\n\t\t\tfilename += \".geotales\";\n\t\t\tdata = \"data:application/json;charset=utf-8,\" + encodeURIComponent( export_project() );\n\t\t\tbreak;\n\n\t\tcase \"geojson\":\n\t\t\tfilename += \".geojson\";\n\t\t\tdata = \"data:application/geo+json;charset=utf-8,\" + encodeURIComponent( export_geojson() );\n\t\t\tbreak;\n\n\t\tdefault: return;\n\t}\n\n\tel.setAttribute(\"href\", data);\n\tel.setAttribute(\"download\", filename);\n\tel.style.display = \"none\";\n\n\tdocument.body.appendChild(el);\n\t$(el).ready(() => { el.click(); document.body.removeChild(el); running = false; });\n}\n\nexport function save_data(callback) {\n\t$.ajax({\n\t\ttype: \"POST\",\n\t\turl: \"api.php\",\n\t\tdata: {\n\t\t\t\"op\": \"map_write\",\n\t\t\t\"id\": _ID,\n\t\t\t\"data\": export_project(),\n\t\t\t\"preview\": _MAP.getCenterBasemapTile()\n\t\t},\n\t\tdataType: \"json\",\n\t\tsuccess: function(result, status, xhr) {\n\t\t\tsaved_changes();\n\t\t\tsetTimeout(function() { if(callback) { callback(); } }, 750);\n\t\t},\n\t\terror: function(xhr, status, error) {\n\t\t\tconsole.error(xhr.status, error);\n\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t}\n\t});\n}\n\n\n\nexport function unsaved_changes() {\n\t$(window).off(\"beforeunload\");\n\t$(window).on(\"beforeunload\", ev => {\n\t\tev.preventDefault();\n\n\t\tlet m = \"Unsaved changes could be lost. Are you sure you want to close?\";\n\t\tev.returnValue = m;\n\t\treturn m;\n\t});\n}\n\nexport function saved_changes() {\n\t$(window).off(\"beforeunload\");\n}\n\n\n\nexport function flash_map() {\n\t$(\"div#map\").addClass(\"snapshot\");\n\tsetTimeout(function() { $(\"div#map\").removeClass(\"snapshot\"); }, 240);\n}\n\n\n\nexport function get_basemap(url) {\n\tfor(let b of _BASEMAPS) {\n\t\tif(b.tiles._url == url) { return b; }\n\t}\n\treturn null;\n}\n\nfunction bind_basemaps() {\n\t$(\"#basemapModal #basemaps\").off(\"click\");\n\t$(\"#basemapModal #basemaps\").click(async function(ev) {\n\t\tlet index = $(ev.target).data(\"basemap\");\n\t\tif(!index && index !== 0) { return; }\n\n\t\tawait _MAP.setBasemap( _BASEMAPS[index].tiles );\n\t\t_SCENES.setBasemap();\n\t});\n\n\t$(\"#basemapModal button#uploadBasemap\").click(function(ev) {\n\t\t$(\"#basemapModal input#basemapFile\").click();\n\t});\n}\nexport function init_basemaps() {\n\tgenerate_basemaps(false); bind_basemaps();\n}\nexport function init_img_basemaps() {\n\tgenerate_basemaps(true); bind_basemaps();\n}\n\n\n\nexport function get_aspect_ratio_dimentions(w, h, r) {\n\tlet _w = r * h;\n\tif(_w <= w) {\n\t\treturn [_w, h];\n\t}else{\n\t\treturn [w, w / r];\n\t}\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\n\nexport function new_scene(id, prevId) {\n\n\tlet cont = `\n\t\t<li class=\"list-group-item p-1 my-1\" id=\"${id}\" data-id=\"${id}\">\n\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t<button type=\"button\" class=\"btn btn-outline-light\" id=\"reorder\" title=\"Change ordering\">\n\t\t\t\t\t<i class=\"fas fa-bars\"></i>\n\t\t\t\t</button>\n\t\t\t\t<input type=\"text\" class=\"form-control\" id=\"title\" aria-label=\"Title\" aria-describedby=\"num\" />\n\t\t\t\t<span class=\"input-group-text\" id=\"num\"></span>\n\t\t\t</div>\n\t\t</li>\n\t`;\n\n\tif(prevId) { $(`li[data-id=\"${prevId}\"]`).after(cont); }\n\telse{ $(\"ul#scenes\").append(cont); }\n\n}\n\n\n\nexport function generate_basemaps(isUpload) {\n\tlet html = ``;\n\n\tfor(let i = 0; i < _BASEMAPS.length; i++) {\n\t\tlet b = _BASEMAPS[i];\n\t\tif(b.name !== \"\" && isUpload) { continue; }\n\t\thtml += `\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"card mt-2\">\n\t\t\t\t\t<div class=\"card-body\">\n\t\t\t\t\t\t<h6 class=\"card-title mb-0\">${b.name}</h6>\n\t\t\t\t\t</div>\n\t\t\t\t\t<img class=\"card-img-bottom\" id=\"basemaps\" src=\"${b.preview}\" alt=\"${b.name}\" data-basemap=\"${i}\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\tif(isUpload) {\n\t\thtml += `\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"card mt-2\">\n\t\t\t\t\t<div class=\"card-body\">\n\t\t\t\t\t\t<div class=\"d-grid\">\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-outline-secondary\" id=\"uploadBasemap\" ${!_USER_PAID ? \"disabled\" : \"\"}>+</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t$(isUpload ?\n\t\t\"#basemapModal #imgBasemapChoose\" :\n\t\t\"#basemapModal #basemapChoose\").html(html);\n}\n\n\n\nexport function avatar_popup() {\n\n\treturn `\n\t\t<form class=\"container-fluid objectPopup\" id=\"avatarPopup\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control form-control-sm\" id=\"label\" aria-label=\"label\" placeholder=\"Label\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<div class=\"input-group-text\">\n\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"form-check-input mt-0\" id=\"rounded\" value=\"\" aria-label=\"Rounded\" title=\"Rounded\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<input type=\"number\" min=\"10\" max=\"500\" step=\"1\" class=\"form-control\" id=\"size\" placeholder=\"Size\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"accordion\" id=\"iconAccordion\">\n\t\t\t\t\t\t<div class=\"accordion-item\">\n\t\t\t\t\t\t\t<h2 class=\"accordion-header\" id=\"iconAccordionHeading\">\n\t\t\t\t\t\t\t\t<button class=\"accordion-button collapsed py-1 px-2\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#iconAccordionCollapse\" aria-expanded=\"false\" aria-controls=\"iconAccordionCollapse\">\n\t\t\t\t\t\t\t\t\tIcon\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t<div id=\"iconAccordionCollapse\" class=\"accordion-collapse collapse\" aria-labelledby=\"iconAccordionHeading\" data-bs-parent=\"#iconAccordion\">\n\t\t\t\t\t\t\t\t<div class=\"accordion-body py-1\" style=\"max-height: 80px; overflow-y: auto;\">\n\t\t\t\t\t\t\t\t\t<div class=\"row row-cols-5\" id=\"iconChoose\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"col\">\n\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" id=\"iconAdd\" title=\"Add icon\">+</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t  </div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"color\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"10\" class=\"form-control\" id=\"thickness\" placeholder=\"Thickness\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"3\" step=\"0.1\" class=\"form-control\" id=\"blur\" placeholder=\"Blur\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"1\" step=\"0.1\" class=\"form-control\" id=\"grayscale\" placeholder=\"Grayscale\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"6\" step=\"1\" class=\"form-control\" id=\"brightness\" placeholder=\"Brightness\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"0.9\" step=\"0.1\" class=\"form-control\" id=\"transparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row mb-2\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"number\" class=\"form-control form-control-sm\" id=\"animationSpeed\" min=\"0.1\" max=\"10\" step=\"0.1\" aria-label=\"Animation speed\" placeholder=\"Animation speed (sec.)\" title=\"This objects animation speed to next scene\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary py-0\" id=\"makeGlobal\" title=\"Save options globally\">\n\t\t\t\t\t\t<i class=\"fas fa-save\"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t`;\n\n}\n\nexport function polyline_popup() {\n\n\treturn `\n\t\t<form class=\"container-fluid objectPopup\" id=\"shapePopup\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control form-control-sm\" id=\"label\" aria-label=\"label\" placeholder=\"Label\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"lineColor\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"2\" max=\"10\" class=\"form-control\" id=\"lineThickness\" placeholder=\"Thickness\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"0.9\" step=\"0.1\" class=\"form-control\" id=\"lineTransparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"form-check mt-1\">\n\t\t\t\t\t\t<input class=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"dashed\">\n\t\t\t\t\t\t<label class=\"form-check-label\" for=\"dashed\">Dashed</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row mb-2\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"number\" class=\"form-control form-control-sm\" id=\"animationSpeed\" min=\"0.1\" max=\"10\" step=\"0.1\" aria-label=\"Animation speed\" placeholder=\"Animation speed (sec.)\" title=\"This objects animation speed to next scene\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary py-0\" id=\"makeGlobal\" title=\"Save options globally\">\n\t\t\t\t\t\t<i class=\"fas fa-save\"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t`;\n\n}\n\nexport function polygon_popup() {\n\n\treturn `\n\t\t<form class=\"container-fluid objectPopup\" id=\"shapePopup\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control form-control-sm\" id=\"label\" aria-label=\"label\" placeholder=\"Label\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"lineColor\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"2\" max=\"10\" class=\"form-control\" id=\"lineThickness\" placeholder=\"Thickness\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"0.9\" step=\"0.1\" class=\"form-control\" id=\"lineTransparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"form-check mt-1\">\n\t\t\t\t\t\t<input class=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"dashed\">\n\t\t\t\t\t\t<label class=\"form-check-label\" for=\"dashed\">Dashed</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"fillColor\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"1\" step=\"0.1\" class=\"form-control\" id=\"fillTransparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row mb-2\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"number\" class=\"form-control form-control-sm\" id=\"animationSpeed\" min=\"0.1\" max=\"10\" step=\"0.1\" aria-label=\"Animation speed\" placeholder=\"Animation speed (sec.)\" title=\"This objects animation speed to next scene\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary py-0\" id=\"makeGlobal\" title=\"Save options globally\">\n\t\t\t\t\t\t<i class=\"fas fa-save\"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t`;\n\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { uuid, save_data, flash_map } from \"./helpers.js\";\nimport { new_scene } from \"./generate.js\";\n\n\nexport function Scenes() {\n\tthis.store = [];\n\tthis.active = \"\";\n\tthis.copiedBounds = null;\n\n\n\tthis.setup = function() {\n\t\t$(\"#scenes\").sortable({ // https://api.jqueryui.com/sortable/\n\t\t\tcursor: \"move\", handle: \"button#reorder\", items: \"> li\", containment: \"parent\", tolerance: \"pointer\", cancel: \"\", zIndex: 1003, axis: \"x\", //scroll: false,\n\t\t\tstart: (ev, ui) => {\n\t\t\t\tev.stopPropagation();\n\t\t\t\tthis.unbind();\n\t\t\t},\n\t\t\tupdate: (ev, ui) => {\n\t\t\t\tev.stopPropagation();\n\t\t\t\t//let id = $(ui.item[0]).data(\"id\"), order = $(\"#scenes\").sortable(\"toArray\");\n\t\t\t\tthis.reorder( $(\"#scenes\").sortable(\"toArray\") );\n\t\t\t},\n\t\t\tstop: (ev, ui) => {\n\t\t\t\tev.stopPropagation();\n\t\t\t\tthis.bind();\n\t\t\t}\n\t\t});\n\n\t\t$(\"#sceneRow button#delete, #sceneRow button#recapture\").prop(\"disabled\", false);\n\t};\n\n\tthis.reset = function() {\n\t\t$(\"#scenes\").sortable(\"destroy\");\n\t\t$(\"#sceneRow button#delete, #sceneRow button#recapture\").prop(\"disabled\", true);\n\t};\n\n\tthis.get = function(id) {\n\t\tfor(let i = 0; i < this.store.length; i++) {\n\t\t\tlet s = Object.assign({}, this.store[i]);\n\t\t\tif(s.id == id) { s.index = i; return s; }\n\t\t}\n\t\treturn null;\n\t};\n\n\tthis.getEl = function(el) {\n\t\tfor(let i = 0; i < this.store.length; i++) {\n\t\t\tlet s = Object.assign({}, this.store[i]);\n\t\t\tif( $(`li[data-id=\"${s.id}\"]`)[0].contains(el) ) { s.index = i; return s; }\n\t\t}\n\t\treturn null;\n\t};\n\n\tthis.getPrevScene = function(id) {\n\t\tlet s = this.get(id);\n\t\tif(!s || s.index <= 0) { return; }\n\n\t\treturn Object.assign({}, this.store[ s.index - 1 ]);\n\t};\n\n\tthis.reorder = function(order) {\n\t\tthis.store.sort((a,b) => order.indexOf(a.id) - order.indexOf(b.id));\n\t\tthis.set(this.active);\n\t};\n\n\tthis.add = function() {\n\t\tif(this.store.length <= 0) {\n\t\t\tdocument.dispatchEvent( new Event(\"_setup\") );\n\t\t}\n\n\t\tlet s = new Scene(null, this.active);\n\t\ts.capture();\n\n\t\tif(this.active) { this.store.splice(this.get(this.active).index + 1, 0, s); }\n\t\telse{ this.store.push(s); }\n\n\t\t_TEXTBOXES.addScene(s.id);\n\t\t_MAP.addScene(s.id);\n\n\t\tthis.set(s.id);\n\t\tthis.bind();\n\n\t\tsave_data();\n\t};\n\n\tthis.capture = function() {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.store[ this.get(this.active).index ];\n\t\ts.capture();\n\t\tflash_map();\n\t\tsave_data();\n\t};\n\n\tthis.delete = function() {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.get( this.active );\n\n\t\t_TEXTBOXES.deleteScene(s.id);\n\t\t_MAP.deleteScene(s.id);\n\n\t\tif( !this.prev() ) { this.next(); }\n\n\t\tthis.store.splice(s.index, 1);\n\n\t\t$(`li[data-id=\"${s.id}\"]`).remove();\n\n\t\tthis.setNumbering();\n\n\t\tif(this.store.length <= 0) {\n\t\t\tthis.active = \"\";\n\t\t\tdocument.dispatchEvent( new Event(\"_reset\") );\n\t\t}\n\n\t\tsave_data();\n\t};\n\n\tthis.unbind = function() {\n\t\t$(\"#scenes li button#reorder\").prop(\"disabled\", true);\n\t\t$(\"#scenes li\").off(\"click\");\n\t};\n\tthis.bind = function() {\n\t\t$(\"#scenes li button#reorder\").prop(\"disabled\", false);\n\t\t$(\"#scenes li\").off(\"click\");\n\t\t$(\"#scenes li\").click(ev => {\n\t\t\tlet s = this.getEl(ev.target);\n\t\t\tif(!s) { return; }\n\n\t\t\tlet el = $(`li[data-id=\"${s.id}\"]`);\n\t\t\tif(el.hasClass(\"active\")) { return; }\n\n\t\t\tthis.set(s.id);\n\t\t});\n\t};\n\n\tthis.prev = function() {\n\t\tlet s = this.get(this.active);\n\t\tif(!s || s.index <= 0) { return; }\n\n\t\ts = this.store[ s.index - 1 ];\n\t\tthis.set(s.id);\n\t\treturn Object.assign({}, s);\n\t};\n\n\tthis.current = function() {\n\t\tthis.set(this.active);\n\t\tthis.bind();\n\t};\n\n\tthis.next = function() {\n\t\tlet s = this.get(this.active);\n\t\tif(!s || s.index >= this.store.length - 1) { return; }\n\n\t\ts = this.store[ s.index + 1 ];\n\t\tthis.set(s.id);\n\t\treturn Object.assign({}, s);\n\t};\n\n\tthis.set = function(id) {\n\t\tif(this.active) { this.get(this.active).disable(); }\n\t\tthis.active = id;\n\n\t\tlet s = this.get(id);\n\t\ts.enable();\n\n\t\t$(`li[data-id=\"${s.id}\"]`)[0].scrollIntoView({ behavior: \"smooth\", inline: \"center\" });\n\n\t\t_TEXTBOXES.set(s.id);\n\t\t_MAP.set(s.id);\n\n\t\tthis.setNumbering();\n\t};\n\n\tthis.setWMS = function() {\n\t\tthis.store[ this.get(this.active).index ].setWMS();\n\t};\n\tthis.setBasemap = function() {\n\t\tthis.store[ this.get(this.active).index ].setBasemap();\n\t};\n\n\tthis.setBookmark = function(b) {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.store[ this.get(this.active).index ];\n\t\ts.setBookmark(b);\n\t\tsave_data();\n\t};\n\n\tthis.setNumbering = function() {\n\t\tlet i = 1;\n\t\tfor(let n of $(\"#scenes li span#num\")) {\n\t\t\t$(n).html(i++);\n\t\t}\n\t};\n\n\tthis.copyBounds = function() {\n\t\tif(!this.active) { return; }\n\n\t\tthis.copiedBounds = this.get(this.active).bounds;\n\t};\n\n\tthis.pasteBounds = function() {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.store[ this.get(this.active).index ];\n\t\ts.setBounds(this.copiedBounds);\n\t};\n\n\tthis.importData = function(data) {\n\t\tif(data.length <= 0) { return; }\n\n\t\tif(this.store.length <= 0 || !this.active) {\n\t\t\tthis.active = data[0].id;\n\t\t}\n\n\t\tfor(let o of data) {\n\t\t\tlet s = new Scene(o.id);\n\t\t\ts.bounds = o.bounds;\n\t\t\ts.wms = o.wms;\n\t\t\ts.basemap = o.basemap;\n\n\t\t\ts.setBookmark(o.bookmark);\n\t\t\ts.setTitle(o.title);\n\n\t\t\ts.disable();\n\n\t\t\tthis.store.push(s);\n\t\t}\n\t};\n\n\tthis.exportData = function() {\n\t\tlet r = [];\n\t\tfor(let s of this.store) { r.push( s.exportData() ); }\n\t\treturn r;\n\t};\n}\n\n\n\nfunction Scene(id, prevId) {\n\tthis.id = id || uuid();\n\n\tthis.bounds = null;\n\tthis.wms = null;\n\tthis.basemap = null;\n\n\tthis.bookmark = false;\n\tthis.title = \"\";\n\n\tnew_scene(this.id, prevId);\n\n\t$(`li[data-id=\"${this.id}\"]`).on(\"keydown keyup\", ev => { ev.stopPropagation(); });\n\t$(`li[data-id=\"${this.id}\"] input#title`).change(ev => { this.title = ev.target.value; });\n\n\n\tthis.enable = function() {\n\t\t$(`li[data-id=\"${this.id}\"]`).addClass(\"active\");\n\t\t$(`li[data-id=\"${this.id}\"] input, li[data-id=\"${this.id}\"] button`).prop(\"disabled\", false);\n\t\t$(`li[data-id=\"${this.id}\"] input, li[data-id=\"${this.id}\"] button`).click(ev => { ev.stopPropagation(); });\n\t};\n\n\tthis.disable = function() {\n\t\t$(`li[data-id=\"${this.id}\"]`).removeClass(\"active\");\n\t\t$(`li[data-id=\"${this.id}\"] input`).prop(\"disabled\", true);\n\t\t$(`li[data-id=\"${this.id}\"] input, li[data-id=\"${this.id}\"] button`).off(\"click\");\n\t};\n\n\tthis.setBounds = function(bounds) {\n\t\tthis.bounds = bounds;\n\t\t_MAP.setFlyTo( this.bounds );\n\t};\n\n\tthis.setWMS = function() { this.wms = _MAP.getWMS(); };\n\tthis.setBasemap = function() { this.basemap = _MAP.getBasemap(); };\n\n\tthis.setBookmark = function(b) {\n\t\tthis.bookmark = b;\n\t\tif(b) { $(`li[data-id=\"${this.id}\"]`).addClass(\"bookmark\"); }\n\t\telse{ $(`li[data-id=\"${this.id}\"]`).removeClass(\"bookmark\"); }\n\t};\n\n\tthis.setTitle = function(t) {\n\t\tthis.title = t;\n\t\t$(`li[data-id=\"${this.id}\"] input#title`).val(this.title);\n\t};\n\n\tthis.capture = function() {\n\t\tlet nw = _MAP.getBounds().getNorthWest(),\n\t\t\tse = _MAP.getBounds().getSouthEast();\n\t\tthis.setBounds( [[nw.lat, nw.lng], [se.lat, se.lng]] );\n\t\tthis.setBasemap();\n\t};\n\n\tthis.exportData = function() {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tbounds: this.bounds,\n\t\t\twms: this.wms,\n\t\t\tbasemap: this.basemap,\n\t\t\tbookmark: this.bookmark,\n\t\t\ttitle: this.title\n\t\t};\n\t};\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { uuid, save_data } from \"./helpers.js\";\n\n\nexport function Textboxes() {\n\tthis.store = [];\n\n\t$(\"input#_img_textbox\").change(function(ev) {\n\t\tlet file = $(this)[0].files[0];\n\t\tif(!file) { return; }\n\n\t\t$(\"#loadingModal\").modal(\"show\");\n\t\tlet data = new FormData();\n\t\tdata.append(\"op\", \"upload_create\");\n\t\tdata.append(\"type\", \"image\");\n\t\tdata.append(\"image\", file);\n\t\t$.ajax({\n\t\t\ttype: \"POST\",\n\t\t\turl: \"api.php\",\n\t\t\tdata: data,\n\t\t\tcontentType: false,\n\t\t\tprocessData: false,\n\t\t\tsuccess: function(result, status, xhr) {\n\t\t\t\t$(\"#textbox #content\").trumbowyg(\"execCmd\", { cmd: \"insertImage\", param: result, forceCss: false, skipTrumbowyg: true });\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t\t},\n\t\t\terror: function(xhr, status, error) {\n\t\t\t\tconsole.log(xhr.status, error);\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t\t}\n\t\t});\n\t});\n\n\t$(\"#textbox input#lock\").change(ev => {\n\t\tthis.setLock( ev.target.checked );\n\t});\n\n\t$(\"#textbox button#close\").click(ev => { this.delete(_SCENES.active); });\n\n\t$(\"#textboxOptionsModal select#bookOrientation\").change(ev => {\n\t\tthis.setOrientation( ev.target.value );\n\t});\n\n\n\tthis.setup = function() {\n\t\t$(\"#textbox\").resizable({ // https://api.jqueryui.com/resizable/\n\t\t\tcontainment: \"#mapRow\", handles: \"e\", minWidth: 100,\n\t\t\tstop: (ev, ui) => {\n\t\t\t\tlet w = ui.size.width / ($(\"#mapRow\").outerWidth() - 20),\n\t\t\t\t\tt = this.get(_SCENES.active);\n\t\t\t\tif(t) {\n\t\t\t\t\tthis.store[ t.index ].dim = [0, w];\n\t\t\t\t\t$(\"#textbox\").css({ width: `${w * 100}%` });\n\t\t\t\t\tif(t.pos == \"right\") { $(\"#textbox\").css({ left: \"auto\" }); }\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$(\"#textbox #content\").trumbowyg({\n\t\t\tautogrow: true, semantic: false, resetCss: true, removeformatPasted: true, urlProtocol: true,\n\t\t\tdefaultLinkTarget: \"_blank\",\n\t\t\ttagsToRemove: [\"script\", \"link\"],\n\t\t\tbtnsDef: {\n\t\t\t\tformat: { dropdown: [\"bold\", \"italic\", \"underline\", \"del\"], title: \"Format\", ico: \"bold\" },\n\t\t\t\talign: {\n\t\t\t\t\tdropdown: [\"justifyLeft\", \"justifyCenter\", \"justifyRight\", \"justifyFull\", \"unorderedList\", \"orderedList\"],\n\t\t\t\t\ttitle: \"List/Align\",\n\t\t\t\t\tico: \"justifyLeft\"\n\t\t\t\t},\n\t\t\t\tuploadImg: {\n\t\t\t\t\tfn: ev => { $(\"input#_img_textbox\").click(); },\n\t\t\t\t\ttitle: \"Add image\", ico: \"insertImage\"\n\t\t\t\t},\n\t\t\t\tmakeLink: {\n\t\t\t\t\tfn: ev => {\n\t\t\t\t\t\t$(\"#textbox #content\").trumbowyg(\"saveRange\");\n\t\t\t\t\t\tlet text = $(\"#textbox #content\").trumbowyg(\"getRangeText\");\n\t\t\t\t\t\tif(text.replace(/\\s/g, \"\") == \"\") { return; }\n\n\t\t\t\t\t\tif([\"http\", \"https\"].indexOf(text.split(\"://\")[0]) < 0) { text = `https://${text}`; }\n\t\t\t\t\t\t$(\"#textbox #content\").trumbowyg(\"execCmd\", { cmd: \"insertHTML\", param: `<a href=\"${text}\" target=\"_blank\">${text}</a>`, forceCss: false });\n\t\t\t\t\t},\n\t\t\t\t\ttitle: \"Create link\", ico: \"link\"\n\t\t\t\t}\n\t\t\t},\n\t\t\tbtns: [\n\t\t\t\t[\"formatting\"], [\"format\"], [\"align\"], [\"fontfamily\"], [\"foreColor\", \"backColor\"], [\"makeLink\"], [\"uploadImg\"]\n\t\t\t],\n\t\t\tplugins: {}\n\t\t}).on(\"tbwchange\", () => {\n\t\t\tlet t = this.get(_SCENES.active);\n\t\t\tif(t) { this.store[ t.index ].content = $(\"#textbox #content\").trumbowyg(\"html\"); }\n\t\t});\n\n\t\t_MAP.setOrientation(\"right\");\n\t};\n\n\tthis.reset = function() {\n\t\t$(\"#textbox\").resizable(\"destroy\");\n\t\t$(\"#textbox #content\").trumbowyg(\"destroy\");\n\t\t_MAP.setOrientation(\"right\");\n\t};\n\n\tthis.get = function(sceneId) {\n\t\tfor(let i = 0; i < this.store.length; i++) {\n\t\t\tlet t = Object.assign({}, this.store[i]);\n\t\t\tif(t.sceneId == sceneId) { t.index = i; return t; }\n\t\t}\n\t\treturn null;\n\t};\n\n\tthis.add = function() {\n\t\tif(!_SCENES.active) { return; }\n\n\t\tlet t = new Textbox(null);\n\t\tt.sceneId = _SCENES.active;\n\t\tt.enable();\n\t\tthis.store.push(t);\n\t\tsave_data();\n\t};\n\n\tthis.addScene = function(sceneId) {\n\t\tlet prev = _SCENES.getPrevScene(sceneId);\n\t\tif(prev) {\n\t\t\tfor(let t of this.store) {\n\t\t\t\tif(t.sceneId == prev.id && t.locked) {\n\t\t\t\t\tlet tt = new Textbox(null);\n\t\t\t\t\ttt.sceneId = sceneId;\n\t\t\t\t\ttt.pos = t.pos; tt.dim = t.dim;\n\t\t\t\t\ttt.content = t.content;\n\t\t\t\t\ttt.locked = true;\n\t\t\t\t\ttt.enable();\n\t\t\t\t\tthis.store.push(tt);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.delete = function(sceneId) {\n\t\tlet t = this.get(sceneId);\n\t\tif(!t) { return; }\n\n\t\tt.disable();\n\t\tthis.store.splice(t.index, 1);\n\t\tsave_data();\n\t};\n\n\tthis.deleteScene = function(sceneId) {\n\t\tfor(let t of this.store) {\n\t\t\tif(t.sceneId == sceneId) { this.delete(t.sceneId); }\n\t\t}\n\t};\n\n\tthis.set = function(sceneId) {\n\t\tfor(let t of this.store) {\n\t\t\tif(t.sceneId == sceneId) { t.enable(); break; }\n\t\t\telse{ t.disable(); }\n\t\t}\n\t};\n\n\tthis.setLock = function(l) {\n\t\tlet t = this.get(_SCENES.active);\n\t\tif(!t) { return; }\n\n\t\tthis.store[ t.index ].setLock(l);\n\t};\n\n\tthis.setOrientation = function(pos) {\n\t\tlet t = this.get(_SCENES.active);\n\t\tif(!t) { return; }\n\n\t\tthis.store[ t.index ].pos = pos;\n\t\tthis.store[ t.index ].setOrientation();\n\t};\n\n\tthis.importData = function(data) {\n\t\tif(data.length <= 0) { return; }\n\n\t\tfor(let o of data) {\n\t\t\tlet t = new Textbox(o.id);\n\t\t\tt.sceneId = o.sceneId;\n\t\t\tif(o.pos) { t.pos = o.pos; }\n\t\t\tif(o.dim) { t.dim = o.dim; }\n\t\t\tt.content = o.content;\n\t\t\tt.locked = o.locked;\n\n\t\t\tt.disable();\n\n\t\t\tthis.store.push(t);\n\t\t}\n\t};\n\n\tthis.exportData = function() {\n\t\tlet r = [];\n\t\tfor(let t of this.store) { r.push( t.exportData() ); }\n\t\treturn r;\n\t};\n}\n\n\n\nfunction Textbox(id) {\n\tthis.id = id || uuid();\n\n\tthis.sceneId = \"\";\n\tthis.locked = false;\n\n\tthis.pos = \"left\";\n\tthis.dim = [0, 0.25];\n\tthis.content = \"\";\n\n\n\tthis.setOrientation = function() {\n\t\tswitch(this.pos) {\n\t\t\tcase \"left\":\n\t\t\t\t$(\"#textbox\").css({ left: \"10px\", right: \"auto\" });\n\t\t\t\t$(\"#textbox\").resizable(\"option\", { handles: \"e\" });\n\t\t\t\t_MAP.setOrientation(\"right\");\n\t\t\t\tbreak;\n\n\t\t\tcase \"right\":\n\t\t\t\t$(\"#textbox\").css({ left: \"auto\", right: \"10px\" });\n\t\t\t\t$(\"#textbox\").resizable(\"option\", { handles: \"w\" });\n\t\t\t\t_MAP.setOrientation(\"left\");\n\t\t\t\tbreak;\n\n\t\t\tdefault: break;\n\t\t}\n\t};\n\n\tthis.setLock = function(l) {\n\t\tthis.locked = l;\n\t\t$(\"#textbox input#lock\").prop(\"checked\", this.locked);\n\t};\n\n\tthis.enable = function() {\n\t\tthis.setOrientation();\n\n\t\t$(\"#textbox\").css(\"display\", \"block\");\n\t\t$(\"#textbox\").css({ width: `${this.dim[1] * 100}%` });\n\n\t\t$(\"#textbox #content\").trumbowyg(\"enable\");\n\t\t$(\"#textbox #content\").trumbowyg(\"html\", this.content);\n\n\t\t$(\"#textbox #lock\").prop({ disabled: false, checked: this.locked });\n\n\t\t_MAP.textboxButton.disable();\n\t};\n\n\tthis.disable = function() {\n\t\t$(\"#textbox\").css(\"display\", \"none\");\n\t\t$(\"#textbox #content\").trumbowyg(\"disable\");\n\t\t$(\"#textbox #lock\").prop(\"disabled\", true);\n\t\t_MAP.textboxButton.enable();\n\t};\n\n\tthis.exportData = function() {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tsceneId: this.sceneId,\n\t\t\tlocked: this.locked,\n\t\t\tpos: this.pos,\n\t\t\tdim: this.dim,\n\t\t\tcontent: this.content\n\t\t};\n\t};\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { uuid, save_data, get_aspect_ratio_dimentions, init_img_basemaps } from \"../helpers.js\";\nimport { avatar_popup, polyline_popup, polygon_popup } from \"../generate.js\";\nimport { bind_setup } from \"./layers.js\";\n\n\nL.Map.addInitHook(function() {\n\n\t// Init map aspect ratio\n\n\tthis.setAspectRatio();\n\n\n\n\t// Plugins\n\n\t/*this.addControl( new L.Control.Fullscreen({ position: \"topright\" }) );*/\n\n\t/*this.addControl( L.control.zoom({ position: \"bottomright\" }) );*/\n\n\tthis.returnButton = L.Control.zoomHome({\n\t\tposition: \"bottomright\",\n\t\tzoomHomeIcon: \"home\",\n\t\tzoomHomeTitle: \"Return to map-extent\"\n\t});\n\tthis.addControl( this.returnButton );\n\n\tthis.basemapButton = L.easyButton({\n\t\tid: \"changeBasemap\",\n\t\tposition: \"bottomright\",\n\t\tleafletClasses: true,\n\t\tstates: [\n\t\t\t{\n\t\t\t\tstateName: \"main\",\n\t\t\t\tonClick: function(button, map) { $(\"#basemapModal\").modal(\"show\"); init_img_basemaps(); },\n\t\t\t\ttitle: \"Change basemap\",\n\t\t\t\ticon: \"fa-layer-group\"\n\t\t\t}\n\t\t]\n\t});\n\tthis.addControl( this.basemapButton );\n\tthis.basemapButton.disable();\n\n\tthis.textboxButton = L.easyButton({\n\t\tid: \"addTextbox\",\n\t\tposition: \"topleft\",\n\t\tleafletClasses: true,\n\t\tstates: [\n\t\t\t{\n\t\t\t\tstateName: \"main\",\n\t\t\t\tonClick: function(button, map) { _TEXTBOXES.add(); },\n\t\t\t\ttitle: \"Add book\",\n\t\t\t\ticon: \"fa-comment-alt\"\n\t\t\t}\n\t\t]\n\t});\n\tthis.addControl( this.textboxButton );\n\tthis.textboxButton.disable();\n\n\t/*this.addControl( L.control.locate({ position: \"topright\" }) );*/\n\n\n\n\n\n\t// Basemap\n\n\tthis.basemap = _BASEMAPS[10].tiles;\n\tthis.addLayer( this.basemap );\n\n\t// WMS\n\n\tthis.wms = {};\n\n\n\n\n\n\t// Draw and edit control\n\n\t//L.PM.setOptIn(true);\n\tthis.pm.addControls({\n\t\tposition: \"topright\",\n\t\tdrawCircleMarker: false,\n\t\tdrawText: false,\n\t\toneBlock: true\n\t});\n\tthis.pm.setPathOptions({\n\t\tweight: 3,\n\t\tcolor: \"#563d7c\",\n\t\topacity: 1,\n\t\tfillColor: \"#563d7c\",\n\t\tfillOpacity: 0.2\n\t});\n\tthis.pm.setGlobalOptions({\n\t\tmarkerStyle: {\n\t\t\ticon: L.icon({ iconUrl: \"assets/user-circle-solid.svg\", iconSize: [30, 30], popupAnchor: [0, -15], tooltipAnchor: [0, 15] })\n\t\t}\n\t});\n\tthis.pm.setLang(\"customLang\", {\n\t\ttooltips: { placeMarker: \"Click to place avatar\" },\n\t\tbuttonTitles: { drawMarkerButton: \"Draw avatar\" }\n\t}, \"en\");\n\tthis.disableDraw();\n\n\n\n\n\n\t// Object layers\n\n\tthis.objects = [];\n\tthis.fadeLayer = L.fadeLayer({ pmIgnore: true });\n\tthis.addLayer( this.fadeLayer );\n\n\tthis.on(\"pm:create\", ev => {\n\t\tlet o = ev.layer, type = ev.shape;\n\n\t\tif(type == \"Marker\") {\n\t\t\tlet zoom = this.getZoom();\n\t\t\tlet p = this.project(o.getLatLng(), zoom),\n\t\t\t\turl = o.getIcon().options.iconUrl,\n\t\t\t\tsize = o.getIcon().options.iconSize;\n\t\t\tthis.removeLayer(o);\n\t\t\to = L.imageOverlay(url, [\n\t\t\t\tthis.unproject([ p.x - size[0] / 2, p.y - size[1] / 2 ], zoom),\n\t\t\t\tthis.unproject([ p.x + size[0] / 2, p.y + size[1] / 2 ], zoom)\n\t\t\t], {\n\t\t\t\tinteractive:\t\t\ttrue,\n\t\t\t\tzIndex:\t\t\t\t\t200,\n\t\t\t\tratio:\t\t\t\t\t496 / 512, // NOTE: this is hard-coded from the pixel-width of 'user-circle-solid.svg'\n\t\t\t\trounded:\t\t\t\tfalse,\n\t\t\t\tangle:\t\t\t\t\t0,\n\t\t\t\tborderColor:\t\t\t\"#563d7c\",\n\t\t\t\tborderThickness:\t\t0,\n\t\t\t\toverlayBlur:\t\t\t0,\n\t\t\t\toverlayGrayscale:\t\t0,\n\t\t\t\toverlayBrightness:\t\t0,\n\t\t\t\toverlayTransparency:\t0\n\t\t\t});\n\t\t\tthis.addLayer(o);\n\t\t}\n\n\t\to.options.id = uuid();\n\t\to.options.sceneId = _SCENES.active;\n\n\t\tthis.fire(\"_addedlayer\", { layer: o });\n\n\t\tthis.objects.push( this.extractObject(o) );\n\t});\n\n\tthis.on(\"_addedlayer\", async ev => {\n\t\tlet o = ev.layer;\n\n\t\tlet label = o.options.label;\n\t\tif(label) {\n\t\t\to.bindTooltip(label, { direction: \"center\", permanent: true });\n\t\t\tif(o instanceof L.ImageOverlay) { this.updateTooltip(o); }\n\t\t}\n\n\t\to.on(\"moveend\", ev => { this.updateTooltip(ev.target); });\n\t\to.on(\"pm:edit\", ev => {\n\t\t\tlet o = ev.layer;\n\t\t\tthis.updateObject(o);\n\t\t\tif(o.options.label) { o.closeTooltip(); o.openTooltip(); }\n\t\t});\n\n\t\to.on(\"pm:remove\", ev => {\n\t\t\tlet o = ev.layer;\n\n\t\t\tthis.deleteObject(o);\n\n\t\t\to.closeTooltip(); o.unbindTooltip();\n\t\t\to.closePopup(); o.unbindPopup();\n\t\t\to.off(\"popupopen\"); o.off(\"mouseover\"); o.off(\"mouseout\");\n\n\t\t\to.slideCancel();\n\t\t});\n\n\t\tthis.setPopup(o);\n\n\t\to.on(\"pm:dragstart\", ev => { o.unbindPopup(); });\n\t\to.on(\"pm:dragend\", ev => { this.setPopup( ev.layer ); });\n\n\t\to.on(\"popupopen\", ev => { bind_setup(o); });\n\t\to.on(\"mouseover\", ev => { this.highlightObject(o.options.id); });\n\t\to.on(\"mouseout\", ev => { this.unhighlightObject(o.options.id); });\n\n\t\tlet contextmenu = [\n\t\t\t{ text: \"Move to front\", callback: ev => { o.bringToFront(); }, index: 0 },\n\t\t\t{ text: \"Move to back\", callback: ev => { o.bringToBack(); }, index: 1 }\n\t\t];\n\n\t\tif(o instanceof L.ImageOverlay) {\n\t\t\tcontextmenu.push( { text: \"Clone avatar\", callback: ev => { this.cloneAvatar(o.options.id, o.options.sceneId); }, index: 2 } );\n\t\t\tthis.setIcon(o);\n\t\t}\n\n\t\to.bindContextMenu({ contextmenu: true, contextmenuItems: contextmenu });\n\t});\n\n\tthis.on(\"layeradd\", ev => {\n\t\tlet o = ev.layer;\n\t\t//let opacity = o.options.opacity;\n\n\t\t/* TODO: fade in layer when added\n\t\t\tAlternatively this can be implemented in each prototypes\n\t\t\tonAdd method (in layers.js), instead of here.\n\t\t*/\n\t});\n\n\tthis.on(\"zoomend\", ev => {\n\t\tfor(let o of this.getLayers()) { this.updateTooltip(o); }\n\t});\n\tthis.on(\"zoom\", ev => { if(this._renderer) { this._renderer._reset(); } });\n\n\n\tthis.on(\"movestart\", ev => { /**/ });\n\tthis.on(\"moveend\", ev => { /**/ });\n\n});\n\n\n\n\n\nL.Map.include({\n\n\tsetup: function() {\n\t\tthis.setAspectRatio();\n\n\t\tthis.enableDraw();\n\t\tthis.basemapButton.enable();\n\t\tthis.textboxButton.enable();\n\n\t\t$(\"div.leaflet-control-attribution a\").prop(\"target\", \"_blank\");\n\t},\n\treset: function() {\n\t\tthis.clearLayers();\n\t\tthis.fadeLayer.clearLayers();\n\n\t\tthis.disableDraw();\n\t\tthis.basemapButton.disable();\n\t\tthis.textboxButton.disable();\n\t},\n\n\tenableDraw: function() {\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Marker\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Line\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Polygon\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rectangle\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Circle\", false);\n\t\t//this.pm.Toolbar.setButtonDisabled(\"Text\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Edit\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Drag\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Cut\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Removal\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rotate\", false);\n\t},\n\tdisableDraw: function() {\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Marker\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Line\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Polygon\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rectangle\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Circle\", true);\n\t\t//this.pm.Toolbar.setButtonDisabled(\"Text\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Edit\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Drag\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Cut\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Removal\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rotate\", true);\n\t},\n\n\tsetOrientation: function(pos) {\n\t\tswitch(pos) {\n\t\t\tcase \"left\":\n\t\t\t\tthis.returnButton.setPosition(\"bottomleft\");\n\t\t\t\tthis.basemapButton.setPosition(\"bottomleft\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"draw\", \"topleft\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"edit\", \"topleft\");\n\t\t\t\tthis.textboxButton.setPosition(\"topright\");\n\t\t\t\tbreak;\n\n\t\t\tcase \"right\":\n\t\t\t\tthis.returnButton.setPosition(\"bottomright\");\n\t\t\t\tthis.basemapButton.setPosition(\"bottomright\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"draw\", \"topright\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"edit\", \"topright\");\n\t\t\t\tthis.textboxButton.setPosition(\"topleft\");\n\t\t\t\tbreak;\n\n\t\t\tdefault: break;\n\t\t}\n\t},\n\n\tsetHomeBounds: function(bounds) {\n\t\tif(this.returnButton) {\n\t\t\tthis.returnButton.setHomeBounds(bounds, { maxZoom: this.getMaxZoom() });\n\t\t}\n\t},\n\n\tsetAspectRatio: function(ratio) {\n\t\tif(ratio) { _OPTIONS.aspectratio = ratio; }\n\t\tlet w = $(\"#mapRow\").outerWidth(),\n\t\t\th = $(\"#mapRow\").outerHeight(),\n\t\t\tr = _OPTIONS.aspectratio;\n\n\t\tlet dim = get_aspect_ratio_dimentions(w, h, r);\n\t\t$(\"#map\").css({\n\t\t\twidth: `${(dim[0]/w) * 100}%`,\n\t\t\theight: `calc(${(dim[1]/h) * 100}% - 39px - 49px)`,\n\t\t\tleft: `${(((w - dim[0]) / 2) / w) * 100}%`,\n\t\t\ttop: `calc(${(((h - dim[1]) / 2)/ h) * 100}% + 39px + 49px)`\n\t\t});\n\n\t\tthis.invalidateSize();\n\t\tif(_SCENES.active) { this.setFlyTo( _SCENES.get( _SCENES.active ).bounds ); }\n\t},\n\n\tsetFlyTo: function(bounds) {\n\t\tthis.flyToBounds(bounds, { maxZoom: this.getMaxZoom(), noMoveStart: true, duration: _OPTIONS.panningspeed || null });\n\t\tthis.setHomeBounds(bounds);\n\t},\n\n\n\n\tclearLayers: function() {\n\t\tfor(let o of this.getLayers()) {\n\t\t\tthis.removeLayer(o);\n\t\t}\n\t},\n\n\tgetLayers: function() {\n\t\treturn this.pm.getGeomanLayers();\n\t},\n\n\taddScene: function(sceneId) {\n\t\tlet prev = _SCENES.getPrevScene(sceneId);\n\t\tif(!prev || !_OPTIONS.objectOptIn) { return; }\n\t\tlet prevId = prev.id;\n\n\t\tfor(let object of this.objects) {\n\t\t\tif(object.sceneId == prevId) {\n\t\t\t\tlet o = Object.assign({}, object);\n\t\t\t\to.sceneId = sceneId;\n\t\t\t\tthis.objects.push(o);\n\t\t\t}\n\t\t}\n\n\t\t_SCENES.store[ _SCENES.get(sceneId).index ].setWMS();\n\t},\n\tdeleteScene: function(sceneId) {\n\t\tthis.objects = this.objects.filter(o => o.sceneId != sceneId);\n\t},\n\n\thighlightObject: function(id) {\n\t\tlet o = this.fadeLayer.getObject(id);\n\t\tif(!o) { return; }\n\n\t\tif(o instanceof L.ImageOverlay) { o.setOpacity( 0.8 ); }\n\t\telse{ o.setStyle({ opacity: 0.8 }); }\n\t},\n\tunhighlightObject: function(id) {\n\t\tlet o = this.fadeLayer.getObject(id);\n\t\tif(!o) { return; }\n\n\t\tif(o instanceof L.ImageOverlay) { o.setOpacity( 0.3 ); }\n\t\telse{ o.setStyle({ opacity: 0.3 }); }\n\t},\n\n\tsetObjects: function(sceneId) {\n\t\tlet prev = _SCENES.getPrevScene(sceneId);\n\t\tlet prevId = prev ? prev.id : null;\n\n\t\tthis.fadeLayer.clearLayers();\n\t\tif(prevId) {\n\t\t\tfor(let o of this.objects) {\n\t\t\t\tif(o.sceneId == prevId) { this.fadeLayer.addLayer(this.createObject(o), o.id); }\n\t\t\t}\n\t\t}\n\n\t\tlet os = this.getLayers().map(o => {\n\t\t\tlet r = this.extractObject(o); return { id: r.id, pos: r.pos, radius: r.radius, animationspeed: r.animationspeed };\n\t\t});\n\t\tthis.clearLayers();\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet o = Object.assign({}, this.objects[i]);\n\t\t\tif(o.sceneId == sceneId) {\n\t\t\t\tlet pos = o.pos, rad = o.radius;\n\t\t\t\tfor(let oo of os) {\n\t\t\t\t\tif(o.id == oo.id) {\n\t\t\t\t\t\to.pos = oo.pos;\n\t\t\t\t\t\tif(o.type == \"circle\") { o.radius = oo.radius; }\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet object = this.createObject(o);\n\t\t\t\tthis.addLayer( object );\n\t\t\t\tthis.fire(\"_addedlayer\", { layer: object });\n\n\t\t\t\tfor(let oo of os) {\n\t\t\t\t\tif(o.id == oo.id) {\n\t\t\t\t\t\tobject.slideTo( pos , { radius: rad, duration: oo.animationspeed || _OPTIONS.animationspeed });\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tset: function(sceneId) {\n\t\tlet s = _SCENES.get(sceneId);\n\t\tthis.setBasemap(s.basemap);\n\t\tthis.setWMS(s.wms);\n\t\tthis.setObjects(sceneId);\n\t\tthis.setFlyTo(s.bounds);\n\t},\n\n\tinsertObject: function(o) {\n\t\tfor(let oo of this.getLayers()) {\n\t\t\tif(oo.options.id == o.options.id) { return; }\n\t\t}\n\n\t\tlet object;\n\t\tfor(let oo of this.objects) {\n\t\t\tif(oo.id == o.options.id\n\t\t\t&& oo.sceneId == o.options.sceneId) {\n\t\t\t\tobject = Object.assign({}, oo);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tobject.sceneId = _SCENES.active;\n\n\t\tlet oo = this.createObject(object);\n\t\tthis.addLayer( oo );\n\t\tthis.fire(\"_addedlayer\", { layer: oo });\n\t\tthis.objects.push(object);\n\t},\n\tcloneAvatar: function(id, sceneId) {\n\t\tlet object;\n\t\tfor(let o of this.objects) {\n\t\t\tif(o.id == id && o.sceneId == sceneId) {\n\t\t\t\tobject = Object.assign({}, o);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tobject.id = uuid();\n\n\t\tlet zoom = this.getZoom();\n\t\tlet nw = this.project(object.pos[0], zoom),\n\t\t\tse = this.project(object.pos[1], zoom);\n\t\tnw.x += 50; nw.y += 50;\n\t\tse.x += 50; se.y += 50;\n\t\tnw = this.unproject(nw, zoom);\n\t\tse = this.unproject(se, zoom);\n\n\t\tobject.pos = [[nw.lat, nw.lng], [se.lat, se.lng]];\n\n\t\tlet o = this.createObject(object);\n\t\tthis.addLayer(o);\n\t\tthis.fire(\"_addedlayer\", { layer: o });\n\t\tthis.objects.push(object);\n\t},\n\n\tupdateObject: function(o) {\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet oo = this.objects[i];\n\t\t\tif(oo.id == o.options.id\n\t\t\t&& oo.sceneId == o.options.sceneId) {\n\t\t\t\tthis.objects[i] = this.extractObject(o);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\tdeleteObject: function(o) {\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet oo = this.objects[i];\n\t\t\tif(oo.id == o.options.id\n\t\t\t&& oo.sceneId == o.options.sceneId) {\n\t\t\t\tthis.objects.splice(i, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\tglobalObjectOptions: function(object) {\n\t\tlet o = this.extractObject(object);\n\t\tdelete o.id; delete o.sceneId; delete o.type; delete o.pos;\n\t\tif(object instanceof L.Circle) { delete o.radius; }\n\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet oo = this.objects[i];\n\t\t\tif(oo.id == object.options.id && oo.sceneId != object.options.sceneId) {\n\t\t\t\tthis.objects[i] = Object.assign({}, oo, o);\n\t\t\t}\n\t\t}\n\n\t\tvar object = this.fadeLayer.getObject(object.options.id);\n\t\tif(object) {\n\t\t\tthis.fadeLayer.removeLayer(object);\n\n\t\t\tlet oo = Object.assign({}, this.extractObject(object), o);\n\t\t\tthis.fadeLayer.addLayer(this.createObject(oo), oo.id);\n\t\t}\n\t},\n\n\tsetIcon: function(o, size, icon) {\n\t\tif(!(o instanceof L.ImageOverlay)) { return; }\n\n\t\tif(size) {\n\t\t\tlet zoom = this.getZoom();\n\t\t\tlet c = this.project(o.getBounds().getCenter(), zoom);\n\t\t\to.setBounds([\n\t\t\t\tthis.unproject([ c.x - size[0] / 2, c.y - size[1] / 2 ], zoom),\n\t\t\t\tthis.unproject([ c.x + size[0] / 2, c.y + size[1] / 2 ], zoom)\n\t\t\t]);\n\t\t}\n\t\tif(icon) { o.setUrl(icon); }\n\n\t\t$(o._image).css(\"border-radius\", o.options.rounded ? \"50%\" : \"0\");\n\t\t//$(o._image).css(\"transform\", `rotate(${o.options.angle}deg)`);\n\t\t$(o._image).css(\"border\", `${o.options.borderThickness}px solid ${o.options.borderColor}`);\n\t\t$(o._image).css(\"filter\", `\n\t\t\tblur(${o.options.overlayBlur}px)\n\t\t\tgrayscale(${o.options.overlayGrayscale*100}%)\n\t\t\tdrop-shadow(0 0 ${o.options.overlayBrightness}px yellow)\n\t\t\topacity(${(1 - o.options.overlayTransparency)*100}%)\n\t\t`);\n\n\t\tif(o.options.label) { this.updateTooltip(o); }\n\t},\n\n\tsetPopup: function(o) {\n\t\to.unbindPopup();\n\t\tlet popup =\n\t\t\to instanceof L.ImageOverlay ? avatar_popup() :\n\t\t\to instanceof L.Rectangle\n\t\t || o instanceof L.Polygon\n\t\t || o instanceof L.Circle ? polygon_popup() :\n\t\t\to instanceof L.Polyline ? polyline_popup() : \"\";\n\t\tif(!popup) { return; }\n\t\to.bindPopup(popup, { keepInView: true, closeOnEscapeKey: false, maxWidth: 350, maxHeight: 450 });\n\t},\n\n\tupdateTooltip: function(o) {\n\t\tif(o.getTooltip()) {\n\t\t\to.closeTooltip();\n\t\t\tif(o instanceof L.ImageOverlay) {\n\t\t\t\tlet d = this.latLngToContainerPoint( o.getBounds().getNorthWest() ).distanceTo( this.latLngToContainerPoint( o.getBounds().getSouthWest() ) );\n\t\t\t\to.getTooltip().options.offset = [0, d / 2 - 10];\n\t\t\t}\n\t\t\to.openTooltip();\n\t\t}\n\t},\n\n\n\n\tgetWMS: function() {\n\t\treturn this.wms ? {\n\t\t\ttype: \"wms\",\n\t\t\turl: this.wms._url,\n\t\t\tlayers: this.wms.options.layers,\n\t\t\tformat: this.wms.options.format,\n\t\t\tversion: this.wms.options.version,\n\t\t\ttransparent: this.wms.options.transparent\n\t\t} : null;\n\t},\n\n\tsetWMS: function(source) {\n\t\tif(!source) {\n\t\t\tthis.wms = this.wms ? this.removeLayer( this.wms ) : null;\n\t\t\treturn;\n\t\t}\n\t\tif(this.wms\n\t\t&& (source.url || source._url) == this.wms._url\n\t\t&& (source.layers || source.options.layers) == this.wms.options.layers\n\t\t&& (source.format || source.options.format) == this.wms.options.format\n\t\t&& (source.version || source.options.version) == this.wms.options.version) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet layer;\n\n\t\tif(source instanceof L.TileLayer.WMS) {\n\t\t\tlayer = source;\n\t\t}else\n\t\tif(source.type == \"wms\") {\n\t\t\tlayer = L.tileLayer.wms(source.url, {\n\t\t\t\tlayers: source.layers,\n\t\t\t\tformat: source.format,\n\t\t\t\ttransparent: source.transparent,\n\t\t\t\tversion: source.version,\n\t\t\t\tminZoom: source.minZoom || 0,\n\t\t\t\tmaxZoom: source.maxZoom || 22,\n\t\t\t\tattribution: source.attribution || \"\"\n\t\t\t});\n\t\t}\n\t\telse{ return; }\n\n\t\tif(this.wms) { this.removeLayer( this.wms ); }\n\n\t\tthis.wms = layer;\n\n\t\tthis.addLayer( this.wms );\n\t\tthis.wms.bringToFront();\n\t},\n\n\tgetCenterBasemapTile: function() {\n\t\tif(this.basemap instanceof L.ImageOverlay) {\n\t\t\treturn this.basemap._url;\n\t\t}\n\n\t\tlet s = this.basemap.getTileSize(),\n\t\t\tc = this.project( this.getCenter(), this.getZoom() ),\n\t\t\tr = \"\";\n\n\t\ttry { r = this.basemap.getTileUrl({ x: Math.floor(c.x / s.x), y: Math.floor(c.y / s.y) }); }\n\t\tcatch(e) { console.error(e); }\n\n\t\treturn r;\n\t},\n\n\tgetBasemap: function() {\n\t\tif(this.basemap instanceof L.TileLayer) {\n\t\t\treturn {\n\t\t\t\ttype: \"tiles\",\n\t\t\t\turl: this.basemap._url,\n\t\t\t\tminZoom: this.basemap.options.minZoom,\n\t\t\t\tmaxZoom: this.basemap.options.maxZoom,\n\t\t\t\tattribution: this.basemap.options.attribution\n\t\t\t};\n\t\t}else\n\t\tif(this.basemap instanceof L.ImageOverlay) {\n\t\t\treturn {\n\t\t\t\ttype: \"image\",\n\t\t\t\timg: this.basemap._url\n\t\t\t};\n\t\t}\n\t\treturn null;\n\t},\n\n\tsetBasemap: async function(source) {\n\t\tlet basemap;\n\n\t\tif(source instanceof L.TileLayer) {\n\t\t\tif(this.basemap instanceof L.TileLayer\n\t\t\t&& source._url == this.basemap._url) { return; }\n\n\t\t\tbasemap = source;\n\t\t}else\n\t\tif(source.type == \"tiles\") {\n\t\t\tif(this.basemap instanceof L.TileLayer\n\t\t\t&& source.url == this.basemap._url) { return; }\n\n\t\t\tbasemap = L.tileLayer(source.url, {\n\t\t\t\tminZoom: source.minZoom || 0,\n\t\t\t\tmaxZoom: source.maxZoom || 22,\n\t\t\t\tattribution: source.attribution || `&copy; <a href=\"https://${_HOST}\" target=\"_blank\">GeoTales</a>`\n\t\t\t});\n\t\t}else\n\t\tif(source.type == \"image\") {\n\t\t\tif(this.basemap instanceof L.ImageOverlay\n\t\t\t&& source.img == this.basemap._url) { return; }\n\n\t\t\tlet img = new Image();\n\t\t\timg.src = source.img;\n\t\t\tawait img.decode();\n\n\t\t\tlet r = img.width / img.height;\n\t\t\tlet b = _SCENES.get( _SCENES.active ).bounds;\n\t\t\tlet bounds = [b[0], []];\n\t\t\tlet tlp = this.latLngToContainerPoint(b[0]),\n\t\t\t\tbrp = this.latLngToContainerPoint(b[1]);\n\t\t\tlet h = brp.y - tlp.y,\n\t\t\t\tw = brp.x - tlp.x;\n\n\t\t\tif(r >= 1) { // width >= height\n\t\t\t\tlet p = this.containerPointToLatLng([brp.x, tlp.y + w / r]);\n\t\t\t\tbounds[1][0] = p.lat;\n\t\t\t\tbounds[1][1] = p.lng;\n\t\t\t}else{ // height > width\n\t\t\t\tlet p = this.containerPointToLatLng([tlp.x + r * h, brp.y]);\n\t\t\t\tbounds[1][0] = p.lat;\n\t\t\t\tbounds[1][1] = p.lng;\n\t\t\t}\n\n\t\t\tbasemap = L.imageOverlay(source.img, bounds, {\n\t\t\t\tpmIgnore: true,\n\t\t\t\tzIndex: 0,\n\t\t\t\tminZoom: 0, maxZoom: 1000,\n\t\t\t\tattribution: `&copy; <a href=\"https://${_HOST}\" target=\"_blank\">GeoTales</a>`\n\t\t\t});\n\t\t}\n\t\telse{ return; }\n\n\t\tthis.removeLayer( this.basemap );\n\n\t\tthis.basemap = basemap;\n\n\t\tthis.presetZoom(this.basemap.options.minZoom, this.basemap.options.maxZoom);\n\n\t\tthis.addLayer( this.basemap );\n\t\tthis.basemap.bringToBack();\n\n\t\t$(\"div.leaflet-control-attribution a\").prop(\"target\", \"_blank\");\n\t\tsave_data();\n\t},\n\n\tresetBasemap: function() { this.setBasemap( _BASEMAPS[10].tiles ); },\n\n\tpresetZoom: function(min, max) {\n\t\tlet zoom = this.getZoom();\n\t\tif(zoom < min || zoom > max) {\n\t\t\tif(zoom < min) { this.setZoom(min); }\n\t\t\tif(zoom > max) { this.setZoom(max); }\n\t\t}\n\t\tthis.setMinZoom(min);\n\t\tthis.setMaxZoom(max);\n\t},\n\n\n\n\tcreateObject: function(o) {\n\t\tlet oo = null;\n\n\t\tswitch(o.type) {\n\t\t\tcase \"avatar\":\n\t\t\t\too = L.imageOverlay(o.icon, o.pos, {\n\t\t\t\t\tinteractive:\t\t\ttrue,\n\t\t\t\t\tzIndex:\t\t\t\t\t200,\n\t\t\t\t\tlabel:\t\t\t\t\to.label,\n\t\t\t\t\tratio:\t\t\t\t\to.ratio,\n\t\t\t\t\trounded:\t\t\t\to.rounded,\n\t\t\t\t\tangle:\t\t\t\t\to.angle,\n\t\t\t\t\tborderColor:\t\t\to.borderColor,\n\t\t\t\t\tborderThickness:\t\to.borderThickness,\n\t\t\t\t\toverlayBlur:\t\t\to.blur,\n\t\t\t\t\toverlayBrightness:\t\to.brightness,\n\t\t\t\t\toverlayGrayscale:\t\to.grayscale,\n\t\t\t\t\toverlayTransparency:\to.transparency,\n\t\t\t\t\tanimationspeed:\t\t\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"polyline\":\n\t\t\t\too = L.polyline(o.pos, {\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.color,\n\t\t\t\t\tweight:\t\t\to.thickness,\n\t\t\t\t\topacity:\t\t1 - o.transparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"polygon\":\n\t\t\t\too = L.polygon(o.pos, {\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.lineColor,\n\t\t\t\t\tweight:\t\t\to.lineThickness,\n\t\t\t\t\topacity:\t\t1 - o.lineTransparency,\n\t\t\t\t\tfillColor:\t\to.fillColor,\n\t\t\t\t\tfillOpacity:\t1 - o.fillTransparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"rectangle\":\n\t\t\t\too = L.rectangle(o.pos, {\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.lineColor,\n\t\t\t\t\tweight:\t\t\to.lineThickness,\n\t\t\t\t\topacity:\t\t1 - o.lineTransparency,\n\t\t\t\t\tfillColor:\t\to.fillColor,\n\t\t\t\t\tfillOpacity:\t1 - o.fillTransparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"circle\":\n\t\t\t\too = L.circle(o.pos, {\n\t\t\t\t\tradius:\t\t\to.radius,\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.lineColor,\n\t\t\t\t\tweight:\t\t\to.lineThickness,\n\t\t\t\t\topacity:\t\t1 - o.lineTransparency,\n\t\t\t\t\tfillColor:\t\to.fillColor,\n\t\t\t\t\tfillOpacity:\t1 - o.fillTransparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error(\"object type invalid\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\too.options.id = o.id;\n\t\too.options.sceneId = o.sceneId;\n\n\t\treturn oo;\n\t},\n\n\textractObject: function(o) {\n\t\tlet oo = null;\n\n\t\tif(o instanceof L.ImageOverlay) {\n\t\t\tlet nw = o.getBounds().getNorthWest(), se = o.getBounds().getSouthEast();\n\t\t\too = {\n\t\t\t\tid:\t\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\t\"avatar\",\n\t\t\t\tpos:\t\t\t\t[[nw.lat, nw.lng], [se.lat, se.lng]],\n\t\t\t\tlabel:\t\t\t\to.options.label,\n\t\t\t\ticon:\t\t\t\to._url,\n\t\t\t\tratio:\t\t\t\to.options.ratio,\n\t\t\t\trounded:\t\t\to.options.rounded,\n\t\t\t\tangle:\t\t\t\t0,\n\t\t\t\tborderColor:\t\to.options.borderColor,\n\t\t\t\tborderThickness:\to.options.borderThickness,\n\t\t\t\tblur:\t\t\t\to.options.overlayBlur,\n\t\t\t\tgrayscale:\t\t\to.options.overlayGrayscale,\n\t\t\t\tbrightness:\t\t\to.options.overlayBrightness,\n\t\t\t\ttransparency:\t\to.options.overlayTransparency,\n\t\t\t\tanimationspeed:\t\to.options.animationspeed\n\t\t\t};\n\t\t}else\n\t\tif(o instanceof L.Polygon) {\n\t\t\too = {\n\t\t\t\tid:\t\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\to instanceof L.Rectangle ? \"rectangle\" : \"polygon\",\n\t\t\t\tpos:\t\t\t\to.getLatLngs(),\n\t\t\t\tlabel:\t\t\t\to.options.label,\n\t\t\t\tdashed:\t\t\t\t!!o.options.dashArray,\n\t\t\t\tlineColor:\t\t\to.options.color,\n\t\t\t\tlineThickness:\t\to.options.weight,\n\t\t\t\tlineTransparency:\t1 - o.options.opacity,\n\t\t\t\tfillColor:\t\t\to.options.fillColor,\n\t\t\t\tfillTransparency:\t1 - o.options.fillOpacity,\n\t\t\t\tanimationspeed:\t\to.options.animationspeed\n\t\t\t};\n\t\t}else\n\t\tif(o instanceof L.Polyline) {\n\t\t\too = {\n\t\t\t\tid:\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\"polyline\",\n\t\t\t\tpos:\t\t\to.getLatLngs(),\n\t\t\t\tlabel:\t\t\to.options.label,\n\t\t\t\tdashed:\t\t\t!!o.options.dashArray,\n\t\t\t\tcolor:\t\t\to.options.color,\n\t\t\t\tthickness:\t\to.options.weight,\n\t\t\t\ttransparency:\t1 - o.options.opacity,\n\t\t\t\tanimationspeed:\to.options.animationspeed\n\t\t\t};\n\t\t}else\n\t\tif(o instanceof L.Circle) {\n\t\t\tlet p = o.getLatLng();\n\t\t\too = {\n\t\t\t\tid:\t\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\t\"circle\",\n\t\t\t\tpos:\t\t\t\t[ p.lat, p.lng ],\n\t\t\t\tradius:\t\t\t\to.getRadius(),\n\t\t\t\tlabel:\t\t\t\to.options.label,\n\t\t\t\tdashed:\t\t\t\t!!o.options.dashArray,\n\t\t\t\tlineColor:\t\t\to.options.color,\n\t\t\t\tlineThickness:\t\to.options.weight,\n\t\t\t\tlineTransparency:\t1 - o.options.opacity,\n\t\t\t\tfillColor:\t\t\to.options.fillColor,\n\t\t\t\tfillTransparency:\t1 - o.options.fillOpacity,\n\t\t\t\tanimationspeed:\t\to.options.animationspeed\n\t\t\t};\n\t\t}else{ console.error(\"object type invalid\"); }\n\n\t\treturn oo;\n\t},\n\n\timportData: function(data) {\n\t\tfor(let i = 0; i < data.length; i++) {\n\t\t\tthis.objects.push( data[i] );\n\t\t}\n\t},\n\n\texportData: function() { return this.objects; }\n\n});\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\n\nL.FadeLayer = L.FeatureGroup.extend({\n\taddLayer: function(o, id) {\n\t\tL.FeatureGroup.prototype.addLayer.call(this, o);\n\t\tif(id && !o.options.id) { o.options.id = id; }\n\t\to.options.pmIgnore = true;\n\n\t\tif(o instanceof L.ImageOverlay) {\n\t\t\to.setOpacity( 0.3 );\n\t\t\t$(o._image).css(\"border-radius\", o.options.rounded ? \"50%\" : \"0\");\n\t\t\t//$(o._image).css(\"transform\", `rotate(${o.options.angle}deg)`);\n\t\t\t$(o._image).css(\"border\", `${o.options.borderThickness}px solid ${o.options.borderColor}`);\n\t\t\t$(o._image).css(\"filter\", `\n\t\t\t\tblur(${o.options.overlayBlur}px)\n\t\t\t\tgrayscale(${o.options.overlayGrayscale * 100}%)\n\t\t\t`);\n\t\t}else{\n\t\t\to.setStyle({ opacity: 0.3 });\n\t\t\to.setStyle({ fillOpacity: 0.2 });\n\t\t}\n\t\to.on(\"click\", ev => { _MAP.insertObject(o); });\n\t},\n\n\tgetObject: function(id) {\n\t\tfor(let o of this.getLayers()) {\n\t\t\tif(o.options.id == id) { return o; }\n\t\t}\n\t\treturn null;\n\t},\n\n\tremoveLayer: function(o, id) {\n\t\tvar o = o || (id ? this.getObject(id) : null);\n\t\tif(!o) { return; }\n\t\to.off(\"click\");\n\t\tL.FeatureGroup.prototype.removeLayer.call(this, o);\n\t},\n\n\tinitialize: function(options) {\n\t\tL.FeatureGroup.prototype.initialize.call(this);\n\t\tthis.options.id = \"0\";\n\t\tthis.options = Object.assign({}, this.options, options);\n\t}\n});\nL.fadeLayer = function(options) { return new L.FadeLayer(options); };\n\n\nL.ImageOverlay.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet nw = this.getBounds().getNorthWest(),\n\t\t\tse = this.getBounds().getSouthEast();\n\t\tlet r = {\n\t\t\t\"type\": \"Feature\",\n\t\t\t\"properties\": {\n\t\t\t\t\"type\":\t\t\t\t\"avatar\",\n\t\t\t\t\"label\":\t\t\tthis.options.label,\n\t\t\t\t\"icon\":\t\t\t\tthis._url,\n\t\t\t\t\"ratio\":\t\t\tthis.options.ratio,\n\t\t\t\t\"rounded\":\t\t\tthis.options.rounded,\n\t\t\t\t\"angle\":\t\t\t0,\n\t\t\t\t\"borderColor\":\t\tthis.options.borderColor,\n\t\t\t\t\"borderThickness\":\tthis.options.borderThickness,\n\t\t\t\t\"blur\":\t\t\t\tthis.options.overlayBlur,\n\t\t\t\t\"grayscale\":\t\tthis.options.overlayGrayscale,\n\t\t\t\t\"brightness\":\t\tthis.options.overlayBrightness,\n\t\t\t\t\"transparency\":\t\tthis.options.overlayTransparency\n\t\t\t},\n\t\t\t\"geometry\": {\n\t\t\t\t\"type\": \"Polygon\",\n\t\t\t\t\"coordinates\": [ [nw.lat, nw.lng], [se.lat, se.lng] ]\n\t\t\t}\n\t\t};\n\t\treturn r;\n\t}\n});\n\nL.Polyline.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet r = L.Polyline.prototype.toGeoJSON.call(this);\n\t\tr.properties = {\n\t\t\t\"type\":\t\t\t\"polyline\",\n\t\t\t\"label\":\t\tthis.options.label,\n\t\t\t\"dashed\":\t\t!!this.options.dashArray,\n\t\t\t\"color\":\t\tthis.options.color,\n\t\t\t\"thickness\":\tthis.options.weight,\n\t\t\t\"transparency\":\t1 - this.options.opacity\n\t\t};\n\t\treturn r;\n\t}\n});\n\nL.Polygon.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet r = L.Polygon.prototype.toGeoJSON.call(this);\n\t\tr.properties = {\n\t\t\ttype:\t\t\t\tthis instanceof L.Rectangle ? \"rectangle\" : \"polygon\",\n\t\t\tlabel:\t\t\t\tthis.options.label,\n\t\t\tdashed:\t\t\t\t!!this.options.dashArray,\n\t\t\tlineColor:\t\t\tthis.options.color,\n\t\t\tlineThickness:\t\tthis.options.weight,\n\t\t\tlineTransparency:\t1 - this.options.opacity,\n\t\t\tfillColor:\t\t\tthis.options.fillColor,\n\t\t\tfillTransparency:\t1 - this.options.fillOpacity\n\t\t};\n\t\treturn r;\n\t}\n});\n\nL.Circle.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet r = L.Circle.prototype.toGeoJSON.call(this);\n\t\tr.properties = {\n\t\t\t\"type\":\t\t\t\t\"circle\",\n\t\t\t\"radius\":\t\t\tthis.getRadius(),\n\t\t\t\"label\":\t\t\tthis.options.label,\n\t\t\t\"dashed\":\t\t\t!!this.options.dashArray,\n\t\t\t\"lineColor\":\t\tthis.options.color,\n\t\t\t\"lineThickness\":\tthis.options.weight,\n\t\t\t\"lineTransparency\":\t1 - this.options.opacity,\n\t\t\t\"fillColor\":\t\tthis.options.fillColor,\n\t\t\t\"fillTransparency\":\t1 - this.options.fillOpacity\n\t\t};\n\t\treturn r;\n\t}\n});\n\n\n\n\n\n\n\n\nexport function bind_setup(o) {\n\n\t$(\".objectPopup input#label\").change(function(ev) {\n\t\tlet val = $(this).val();\n\n\t\tif(val) {\n\t\t\tif(!o.getTooltip()) {\n\t\t\t\to.bindTooltip( L.tooltip({ direction: \"center\", permanent: true }, o) );\n\t\t\t\tif(o instanceof L.ImageOverlay) { _MAP.updateTooltip(o); }\n\t\t\t}\n\t\t\to.setTooltipContent(val);\n\t\t}\n\t\telse{ o.unbindTooltip(); }\n\n\t\to.options.label = val;\n\t\t_MAP.updateObject(o);\n\t});\n\t$(\".objectPopup input#label\").val(o.options.label || \"\");\n\n\tif(o instanceof L.ImageOverlay) {\n\t\t$(\"#avatarPopup #iconChoose #iconCol\").remove();\n\t\tfor(let i of _ICONS.slice().reverse()) {\n\t\t\t$(\"#avatarPopup #iconChoose\").prepend(`\n\t\t\t\t<div class=\"col\" id=\"iconCol\">\n\t\t\t\t\t<img class=\"img-fluid rounded\" id=\"icons\" src=\"${i}\" alt=\"&nbsp;\" />\n\t\t\t\t</div>\n\t\t\t`);\n\t\t}\n\n\t\t$(\"input#_img_icon\").off(\"change\");\n\t\t$(\"input#_img_icon\").change(function(ev) {\n\t\t\tlet file = $(this)[0].files[0];\n\t\t\tif(!file) { return; }\n\n\t\t\t$(\"#loadingModal\").modal(\"show\");\n\n\t\t\tlet fr = new FileReader();\n\t\t\tfr.onload = async function() {\n\t\t\t\tlet img = new Image();\n\t\t\t\timg.src = fr.result;\n\t\t\t\tawait img.decode();\n\n\t\t\t\t$(\"#avatarPopup input#rounded\").prop(\"checked\", false);\n\t\t\t\t// TODO: Also set rotation-angle input to 0\n\n\t\t\t\to.options.ratio = img.width / img.height || 1;\n\t\t\t\to.options.rounded = false;\n\t\t\t\to.options.angle = 0;\n\n\t\t\t\tlet data = new FormData();\n\t\t\t\tdata.append(\"op\", \"upload_create\");\n\t\t\t\tdata.append(\"type\", \"icon\");\n\t\t\t\tdata.append(\"image\", file);\n\n\t\t\t\t$.ajax({\n\t\t\t\t\ttype: \"POST\",\n\t\t\t\t\turl: \"api.php\",\n\t\t\t\t\tdata: data,\n\t\t\t\t\tcontentType: false,\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tsuccess: function(result, status, xhr) {\n\t\t\t\t\t\t_ICONS.unshift(result);\n\t\t\t\t\t\t_MAP.setIcon(o, [ 35, 35 / o.options.ratio ], result);\n\t\t\t\t\t\t_MAP.updateObject(o);\n\n\t\t\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t\t\t\t},\n\t\t\t\t\terror: function(xhr, status, error) {\n\t\t\t\t\t\tconsole.error(xhr.status, error);\n\t\t\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\tfr.readAsDataURL(file);\n\t\t});\n\t\t$(\"#avatarPopup #iconChoose #iconAdd\").click(ev => { $(\"input#_img_icon\").click(); });\n\n\t\t$(\"#avatarPopup #iconChoose #icons\").click(async function(ev) {\n\t\t\tlet val = $(this).prop(\"src\");\n\n\t\t\tlet img = new Image();\n\t\t\timg.src = val;\n\t\t\tawait img.decode();\n\n\t\t\to.options.ratio = img.width / img.height || 1;\n\t\t\t_MAP.setIcon(o, [ 35, 35 / o.options.ratio ], val);\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#size\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\t_MAP.setIcon(o, [ val, val / o.options.ratio ]);\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#rounded\").change(function(ev) {\n\t\t\to.options.rounded = this.checked;\n\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\t\t$(\"#avatarPopup input#rounded\").prop(\"checked\", o.options.rounded);\n\n\t\t$(\"#avatarPopup input#color\").change(function(ev) {\n\t\t\tlet val = $(this).val();\n\n\t\t\to.options.borderColor = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\t\t$(\"#avatarPopup input#color\").val(o.options.borderColor || \"#563d7c\");\n\n\t\t$(\"#avatarPopup input#thickness\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.borderThickness = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#blur\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayBlur = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#grayscale\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayGrayscale = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#brightness\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayBrightness = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#transparency\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayTransparency = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\t}else\n\tif(o instanceof L.Path) {\n\t\t$(\"#shapePopup input#dashed\").change(function(ev) {\n\t\t\to.setStyle({ dashArray: this.checked ? \"5, 10\" : \"\" });\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\t\t$(\"#shapePopup input#dashed\").prop(\"checked\", !!o.options.dashArray);\n\n\t\t$(\"#shapePopup input#lineColor\").change(function(ev) {\n\t\t\to.setStyle({ color: $(this).val() });\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\t\t$(\"#shapePopup input#lineColor\").val(o.options.color || \"#563d7c\");\n\n\t\t$(\"#shapePopup input#lineThickness\").change(function(ev) {\n\t\t\to.setStyle({\n\t\t\t\tweight: Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") )\n\t\t\t});\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\t$(\"#shapePopup input#lineTransparency\").change(function(ev) {\n\t\t\to.setStyle({\n\t\t\t\topacity: 1 - Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") )\n\t\t\t});\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\tif(o instanceof L.Rectangle\n\t\t|| o instanceof L.Polygon\n\t\t|| o instanceof L.Circle) {\n\t\t\t$(\"#shapePopup input#fillColor\").change(function(ev) {\n\t\t\t\to.setStyle({ fillColor: $(this).val() });\n\t\t\t\t_MAP.updateObject(o);\n\t\t\t});\n\t\t\t$(\"#shapePopup input#fillColor\").val(o.options.fillColor || \"#563d7c\");\n\n\t\t\t$(\"#shapePopup input#fillTransparency\").change(function(ev) {\n\t\t\t\to.setStyle({\n\t\t\t\t\tfillOpacity: 1 - Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") )\n\t\t\t\t});\n\t\t\t\t_MAP.updateObject(o);\n\t\t\t});\n\t\t}\n\t}else{ console.error(\"object type invalid\"); }\n\n\t$(\".objectPopup input#animationSpeed\").change(function(ev) {\n\t\to.options.animationspeed = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") ) * 1000;\n\t\t_MAP.updateObject(o);\n\t});\n\n\t$(\".objectPopup #makeGlobal\").click(function(ev) {\n\t\t_MAP.globalObjectOptions(o);\n\t});\n}\n"],"names":["$aykGt","parcelRequire","window","onload","ev","document","addEventListener","scale","preventDefault","resizeTimer","$","on","trigger","clearTimeout","setTimeout","_MAP","setAspectRatio","_SCENES","$gUPg4","Scenes","keydown","indexOf","code","keyup","keycode","prev","next","click","add","capture","delete","modal","_TEXTBOXES","$aDjZZ","Textboxes","L","map","center","zoom","innerWidth","zoomControl","maxZoom","doubleClickZoom","zoomAnimationThreshold","wheelPxPerZoomLevel","keyboard","tap","boxZoom","contextmenu","contextmenuItems","text","callback","navigator","clipboard","writeText","latlng","lat","lng","panTo","icon","zoomIn","zoomOut","setup","reset","change","_OPTIONS","animationspeed","this","val","panningspeed","eval","value","objectOptIn","checked","init_basemaps","file","target","files","data","FormData","append","ajax","type","url","contentType","processData","success","async","result","status","xhr","setBasemap","img","_BASEMAPS","push","name","tiles","preview","error","console","split","username","styleID","key","layers","format","version","setWMS","transparent","fr","FileReader","import_data","JSON","parse","readAsText","options","lineColor","lineThickness","lineTransparency","fillColor","fillTransparency","export_data","save_data","setInterval","op","id","_ID","password","dataType","unsaved_changes","r","_ICONS","unshift","ref","$4XDZb","$7aed1fc953746074$export$31b40729666a4ae0","a","Math","random","toString","replace","$7aed1fc953746074$export$3b2ba0326b56a54c","prop","scenes","length","store","dispatchEvent","Event","importData","textboxes","objects","current","$7aed1fc953746074$var$import_project","f","features","o","t","Array","isArray","v","reverse","pos","geometry","coordinates","properties","sceneId","active","label","ratio","rounded","angle","borderColor","borderThickness","blur","overlayBlur","grayscale","overlayGrayscale","brightness","overlayBrightness","transparency","overlayTransparency","dashed","color","thickness","radius","getMaxZoom","getZoom","object","createObject","addLayer","fire","layer","extractObject","$7aed1fc953746074$var$import_geojson","$7aed1fc953746074$var$export_project","stringify","exportData","$7aed1fc953746074$var$running","$7aed1fc953746074$export$b9e8c15d1f8b68a8","el","createElement","date","Date","y","getFullYear","m","getMonth","d","getDate","H","getHours","M","getMinutes","S","getSeconds","filename","_TITLE","encodeURIComponent","getLayers","__toGeoJSON","$7aed1fc953746074$var$export_geojson","setAttribute","style","display","body","appendChild","ready","removeChild","$7aed1fc953746074$export$8915d34f81494a91","getCenterBasemapTile","off","$7aed1fc953746074$export$d36ebd2686ed6eb9","returnValue","$7aed1fc953746074$export$6c9368fbe350f308","addClass","removeClass","$7aed1fc953746074$var$bind_basemaps","index","$7aed1fc953746074$export$4c0c65daf5a0e159","generate_basemaps","$7aed1fc953746074$export$cce986394ab9e86d","$7aed1fc953746074$export$827cb160439a2d7c","w","h","_w","$39cbb0745d491746$export$28821553ef8d960f","prevId","cont","after","$39cbb0745d491746$export$d3ba155dc3b68019","isUpload","html","i","b","_USER_PAID","$39cbb0745d491746$export$d4a4f44bb1d49f04","$39cbb0745d491746$export$3d6e93c41a574db9","$39cbb0745d491746$export$b06e432f08e15d50","$c509a32349fb613e$export$b4dfb75ee92ddb88","copiedBounds","sortable","cursor","handle","items","containment","tolerance","cancel","zIndex","axis","start","ui","stopPropagation","unbind","update","reorder","stop","bind","get","s","Object","assign","getEl","contains","getPrevScene","order","sort","set","$c509a32349fb613e$var$Scene","splice","addScene","flash_map","deleteScene","remove","setNumbering","hasClass","disable","enable","scrollIntoView","behavior","inline","setBookmark","n","copyBounds","bounds","pasteBounds","setBounds","wms","basemap","bookmark","setTitle","title","uuid","new_scene","setFlyTo","getWMS","getBasemap","nw","getBounds","getNorthWest","se","getSouthEast","$7bdd0f4539e9845d$export$1148a9c69cac2f12","trumbowyg","cmd","param","forceCss","skipTrumbowyg","log","setLock","setOrientation","resizable","handles","minWidth","size","width","outerWidth","dim","css","left","autogrow","semantic","resetCss","removeformatPasted","urlProtocol","defaultLinkTarget","tagsToRemove","btnsDef","dropdown","ico","align","uploadImg","fn","makeLink","btns","plugins","content","$7bdd0f4539e9845d$var$Textbox","locked","tt","l","right","disabled","textboxButton","Map","addInitHook","returnButton","Control","zoomHome","position","zoomHomeIcon","zoomHomeTitle","addControl","basemapButton","easyButton","leafletClasses","states","stateName","onClick","button","init_img_basemaps","pm","addControls","drawCircleMarker","drawText","oneBlock","setPathOptions","weight","opacity","fillOpacity","setGlobalOptions","markerStyle","iconUrl","iconSize","popupAnchor","tooltipAnchor","setLang","tooltips","placeMarker","buttonTitles","drawMarkerButton","disableDraw","fadeLayer","pmIgnore","shape","p","project","getLatLng","getIcon","removeLayer","imageOverlay","unproject","x","interactive","bindTooltip","direction","permanent","ImageOverlay","updateTooltip","updateObject","closeTooltip","openTooltip","deleteObject","unbindTooltip","closePopup","unbindPopup","slideCancel","setPopup","$5WMrM","bind_setup","highlightObject","unhighlightObject","bringToFront","bringToBack","cloneAvatar","setIcon","bindContextMenu","_renderer","_reset","include","enableDraw","clearLayers","Toolbar","setButtonDisabled","setPosition","setBlockPosition","setHomeBounds","aspectratio","outerHeight","get_aspect_ratio_dimentions","height","top","invalidateSize","flyToBounds","noMoveStart","duration","getGeomanLayers","filter","getObject","setOpacity","setStyle","setObjects","os","o1","rad","oo","oo1","slideTo","insertObject","oo2","globalObjectOptions","Circle","c","getCenter","setUrl","_image","popup","avatar_popup","Rectangle","Polygon","polygon_popup","Polyline","polyline_popup","bindPopup","keepInView","closeOnEscapeKey","maxWidth","maxHeight","getTooltip","latLngToContainerPoint","distanceTo","getSouthWest","offset","_url","source","TileLayer","WMS","tileLayer","minZoom","attribution","getTileSize","getTileUrl","floor","e","_HOST","Image","src","decode","tlp","brp","containerPointToLatLng","p1","presetZoom","resetBasemap","min","max","setZoom","setMinZoom","setMaxZoom","polyline","dashArray","polygon","rectangle","circle","getLatLngs","getRadius","$4547f3162a1b3a07$export$27a752e5ac5fffb5","tooltip","setTooltipContent","slice","prepend","readAsDataURL","Path","FadeLayer","FeatureGroup","extend","prototype","call","initialize","_map","toGeoJSON"],"version":3,"file":"main.js.map"}