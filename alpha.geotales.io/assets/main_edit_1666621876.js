(function(){function $parcel$export(t,e,o,i){Object.defineProperty(t,e,{get:o,set:i,enumerable:!0,configurable:!0})}var $parcel$global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},$parcel$modules={},$parcel$inits={},parcelRequire=$parcel$global.parcelRequirec19f;null==parcelRequire&&(parcelRequire=function(t){if(t in $parcel$modules)return $parcel$modules[t].exports;if(t in $parcel$inits){var e=$parcel$inits[t];delete $parcel$inits[t];var o={id:t,exports:{}};return $parcel$modules[t]=o,e.call(o.exports,o,o.exports),o.exports}var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i},parcelRequire.register=function(t,e){$parcel$inits[t]=e},$parcel$global.parcelRequirec19f=parcelRequire),parcelRequire.register("Wc23C",(function(module,exports){var $aykGt=parcelRequire("aykGt"),$gUPg4=parcelRequire("gUPg4"),$aDjZZ=parcelRequire("aDjZZ");parcelRequire("4mhKw"),window.onload=function(ev){document.addEventListener("touchmove",(function(t){1!==t.scale&&t.preventDefault()}),!1);let resizeTimer=!1;$(window).on("resize",(function(t){resizeTimer||$(window).trigger("resizestart"),clearTimeout(resizeTimer),resizeTimer=setTimeout((function(){resizeTimer=!1,$(window).trigger("resizeend")}),250)})).on("resizeend",(function(){_MAP.setAspectRatio()})),_SCENES=new(0,$gUPg4.Scenes),$("#sceneRow").keydown((t=>{["ArrowUp","ArrowDown","ArrowRight","ArrowLeft","Space"].indexOf(t.code)>-1&&t.preventDefault()})),$("#sceneRow").keyup((t=>{let e=t.code;"ArrowLeft"==e&&(t.preventDefault(),_SCENES.prev()),"ArrowRight"==e&&(t.preventDefault(),_SCENES.next()),["ArrowUp","ArrowDown","ArrowRight","ArrowLeft","Space"].indexOf(e)>-1&&t.preventDefault()})),$("#sceneRow button#add").click((t=>{_SCENES.add()})),$("#sceneRow button#recapture").click((t=>{_SCENES.capture()})),$("#sceneWarningModal button#delete").click((t=>{_SCENES.delete(),$("#sceneWarningModal").modal("hide")})),_TEXTBOXES=new(0,$aDjZZ.Textboxes),_MAP=L.map("map",{center:[49,14],zoom:window.innerWidth<575.98?3:5,zoomControl:!1,maxZoom:18,doubleClickZoom:!1,zoomAnimationThreshold:100,wheelPxPerZoomLevel:1500,keyboard:!1,tap:!1,boxZoom:!1,contextmenu:!0,contextmenuItems:[{text:"Copy coordinates",callback:t=>{navigator.clipboard.writeText(`${t.latlng.lat}, ${t.latlng.lng}`)}},{text:"Center map here",callback:t=>{_MAP.panTo(t.latlng)}},"-",{text:"Zoom in",icon:"assets/zoom-in.png",callback:t=>{_MAP.zoomIn()}},{text:"Zoom out",icon:"assets/zoom-out.png",callback:t=>{_MAP.zoomOut()}}]}),document.addEventListener("_setup",(t=>{_MAP.setup(),_TEXTBOXES.setup(),_SCENES.setup()})),document.addEventListener("_reset",(t=>{_SCENES.reset(),_TEXTBOXES.reset(),_MAP.reset()})),$("#optionsModal input#animationSpeed").change((function(t){_OPTIONS.animationspeed=1e3*$(this).val()})),$("#optionsModal input#panningSpeed").change((function(t){_OPTIONS.panningspeed=$(this).val()||null})),$("#optionsModal select#aspectRatio").change((function(ev){_MAP.setAspectRatio(eval(this.value))})),$("#optionsModal input#objectsOptIn").change((function(t){_OPTIONS.objectOptIn=this.checked})),(0,$aykGt.init_basemaps)(),$("#basemapModal input#basemapFile").change((t=>{let e=$(t.target)[0].files[0];if(!e)return;$("#loadingModal").modal("show");let o=new FormData;o.append("op","upload_create"),o.append("type","basemap"),o.append("image",e),$.ajax({type:"POST",url:"api.php",data:o,contentType:!1,processData:!1,success:async function(t,e,o){await _MAP.setBasemap({type:"image",img:t}),_SCENES.setBasemap(),_BASEMAPS.push({name:"",tiles:{type:"image",img:t},preview:t}),setTimeout((function(){$("#loadingModal").modal("hide")}),750)},error:function(t,e,o){console.error(t.status,o),setTimeout((function(){$("#loadingModal").modal("hide"),$("#errorModal").modal("show")}),750)}})})),$("#basemapModal button#basemapFetch").click((t=>{let e=$("#basemapModal input#basemapLink").val();if(e){if("mapbox"==e.split(/\:/gi)[0]){let t=e.split(/mapbox\:\/\/styles\//gi)[1].split(/\//gi)[0],o=e.split(/mapbox\:\/\/styles\//gi)[1].split(/\//gi)[1],i=$("#basemapModal input#basemapKey").val();if(!i)return;e=`https://api.mapbox.com/styles/v1/${t}/${o}/tiles/256/{z}/{x}/{y}?access_token=${i}`}_MAP.setBasemap({type:"tiles",url:e}),_SCENES.setBasemap()}})),$("#basemapModal button#wmsAdd").click((t=>{let e=$("#basemapModal input#wmsLink").val(),o=$("#basemapModal input#wmsLayer").val(),i=$("#basemapModal select#wmsFormat").val(),n=$("#basemapModal select#wmsVersion").val();e&&o&&(_MAP.setWMS({type:"wms",url:e,layers:o,format:i,version:n,transparent:"image/png"==i}),_SCENES.setWMS())})),$("#basemapModal button#wmsRemove").click((t=>{_MAP.setWMS(null),_SCENES.setWMS()})),$("#projectFileInput").change((t=>{let e=$(t.target)[0].files[0];if(!e)return;let o=new FileReader;o.onload=function(){(0,$aykGt.import_data)("project",JSON.parse(o.result))},o.readAsText(e)})),$("#geojsonImportModal button#import").click((t=>{$("#geojsonImportModal").modal("hide");let e=$("#geojsonImportModal input#fileInput")[0].files[0];if(!e)return;let o={lineColor:$("#geojsonImportModal #lineColor").val(),lineThickness:$("#geojsonImportModal #lineThickness").val()||3,lineTransparency:$("#geojsonImportModal #lineTransparency").val(),fillColor:$("#geojsonImportModal #fillColor").val(),fillTransparency:$("#geojsonImportModal #fillTransparency").val()||.8},i=new FileReader;i.onload=function(){(0,$aykGt.import_data)("geojson",JSON.parse(i.result),o)},i.readAsText(e)})),$("#gedcomImportModal button#import").click((t=>{$("#gedcomImportModal").modal("hide");let e=$("#gedcomImportModal input#fileInput")[0].files[0];if(!e)return;let o={},i=new FileReader;i.onload=function(){(0,$aykGt.import_data)("gedcom",i.result,o)},i.readAsText(e)})),$("button#export").click((t=>{(0,$aykGt.export_data)($(t.target).data("type")||null)})),$("a#save").click((t=>{$("#loadingModal").modal("show"),(0,$aykGt.save_data)((function(){$("#loadingModal").modal("hide")}))})),setInterval($aykGt.save_data,3e5),$("#loadingModal").modal("show"),$.ajax({type:"GET",url:"api.php",data:{op:"map_read",id:_ID,password:""},dataType:"json",success:function(t,e,o){t.data&&(0,$aykGt.import_data)("project",JSON.parse(t.data)),$("div#sceneRow,\n\t\t\t   div#mapRow,\n\t\t\t   .navbar .navbarContent li").click((t=>{(0,$aykGt.unsaved_changes)()})),setTimeout((function(){$("#loadingModal").modal("hide")}),750)},error:function(t,e,o){console.error(t.status,o),setTimeout((function(){$("#loadingModal").modal("hide"),$("#errorModal").modal("show")}),750)}}),$.ajax({type:"GET",url:"api.php",data:{op:"upload_get"},dataType:"json",success:function(t,e,o){for(let e of t)"icon"==e.type?_ICONS.unshift(e.ref):"basemap"==e.type&&_BASEMAPS.push({name:"",tiles:{type:"image",img:e.ref},preview:e.ref})},error:function(t,e,o){console.error(t.status,o)}})}})),parcelRequire.register("aykGt",(function(t,e){$parcel$export(t.exports,"uuid",(function(){return i})),$parcel$export(t.exports,"import_data",(function(){return n})),$parcel$export(t.exports,"export_data",(function(){return r})),$parcel$export(t.exports,"save_data",(function(){return l})),$parcel$export(t.exports,"unsaved_changes",(function(){return p})),$parcel$export(t.exports,"flash_map",(function(){return c})),$parcel$export(t.exports,"init_basemaps",(function(){return u})),$parcel$export(t.exports,"init_img_basemaps",(function(){return h})),$parcel$export(t.exports,"get_aspect_ratio_dimentions",(function(){return m}));var o=parcelRequire("4XDZb");function i(t){return t?(t^16*Math.random()>>t/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,i)}function n(t,e,o){switch(t){case"project":!function(t){_OPTIONS=t.options,$("#optionsModal input#animationSpeed").val(_OPTIONS.animationspeed/1e3),$("#optionsModal input#panningSpeed").val(_OPTIONS.panningspeed||null),$("#optionsModal input#objectsOptIn").prop("checked",_OPTIONS.objectOptIn),t.scenes.length<=0||(_SCENES.store.length<=0&&document.dispatchEvent(new Event("_setup")),_SCENES.importData(t.scenes),_TEXTBOXES.importData(t.textboxes),_MAP.importData(t.objects),_SCENES.current())}(e);break;case"geojson":!function(t,e){for(let o of t.features){let t,n=t=>{if(Array.isArray(t[0]))for(let e of t)n(e);else t.reverse()},s=o.geometry.coordinates;if(n(s),"avatar"==o.properties.type)t={id:i(),sceneId:_SCENES.active,type:"avatar",pos:s,label:o.properties.label,icon:o.properties.icon,ratio:o.properties.ratio,rounded:o.properties.rounded,angle:o.properties.angle,borderColor:o.properties.borderColor,borderThickness:o.properties.borderThickness,blur:o.properties.overlayBlur,grayscale:o.properties.overlayGrayscale,brightness:o.properties.overlayBrightness,transparency:o.properties.overlayTransparency};else if("polyline"==o.properties.type||"LineString"==o.geometry.type||"MultiLineString"==o.geometry.type)t={id:i(),sceneId:_SCENES.active,type:"polyline",pos:s,label:o.properties.label,dashed:o.properties.dashed,color:o.properties.color||e.lineColor,thickness:o.properties.thickness||e.lineThickness,transparency:o.properties.transparency||e.lineTransparency};else if("polygon"==o.properties.type||"rectangle"==o.properties.type||"Polygon"==o.geometry.type||"MultiPolygon"==o.geometry.type)t={id:i(),sceneId:_SCENES.active,type:"polygon",pos:s,label:o.properties.label,dashed:o.properties.dashed,lineColor:o.properties.lineColor||e.lineColor,lineThickness:o.properties.lineThickness||e.lineThickness,lineTransparency:o.properties.lineTransparency||e.lineTransparency,fillColor:o.properties.fillColor||e.fillColor,fillTransparency:o.properties.fillTransparency||e.fillTransparency};else{if("circle"!=o.properties.type&&"Point"!=o.geometry.type)continue;t={id:i(),sceneId:_SCENES.active,type:"circle",pos:s,radius:o.properties.radius||4e3*(_MAP.getMaxZoom()-_MAP.getZoom()),label:o.properties.label,dashed:o.properties.dashed,lineColor:o.properties.lineColor||e.lineColor,lineThickness:o.properties.lineThickness||e.lineThickness,lineTransparency:o.properties.lineTransparency||e.lineTransparency,fillColor:o.properties.fillColor||e.fillColor,fillTransparency:o.properties.fillTransparency||e.fillTransparency}}let a=_MAP.createObject(t);_MAP.addLayer(a),_MAP.fire("_addedlayer",{layer:a}),_MAP.objects.push(_MAP.extractObject(a))}}(e,o);break;case"gedcom":break;default:console.error("data-import type invalid")}}function s(){return JSON.stringify({options:_OPTIONS,scenes:_SCENES.exportData(),textboxes:_TEXTBOXES.exportData(),objects:_MAP.exportData()})}let a=!1;function r(t){if(a)return;a=!0;let e,o=document.createElement("a"),i=t=>t<10&&t>=0?`0${t}`:`${t}`,n=new Date,r=n.getFullYear(),l=i(n.getMonth()+1),p=i(n.getDate()),c=i(n.getHours()),d=i(n.getMinutes()),u=i(n.getSeconds()),h=`${_TITLE} - ${r}.${l}.${p} - ${c}.${d}.${u}`;switch(t){case"project":h+=".geotales",e="data:application/json;charset=utf-8,"+encodeURIComponent(s());break;case"geojson":h+=".geojson",e="data:application/geo+json;charset=utf-8,"+encodeURIComponent(function(){let t=[];for(let e of _MAP.getLayers())t.push(e.__toGeoJSON());return JSON.stringify({type:"FeatureCollection",features:t})}());break;default:return}o.setAttribute("href",e),o.setAttribute("download",h),o.style.display="none",document.body.appendChild(o),$(o).ready((()=>{o.click(),document.body.removeChild(o),a=!1}))}function l(t){$.ajax({type:"POST",url:"api.php",data:{op:"map_write",id:_ID,data:s(),preview:_MAP.getCenterBasemapTile()},dataType:"json",success:function(e,o,i){$(window).off("beforeunload"),setTimeout((function(){t&&t()}),750)},error:function(t,e,o){console.error(t.status,o),setTimeout((function(){$("#loadingModal").modal("hide"),$("#errorModal").modal("show")}),750)}})}function p(){$(window).off("beforeunload"),$(window).on("beforeunload",(t=>{t.preventDefault();let e="Unsaved changes could be lost. Are you sure you want to close?";return t.returnValue=e,e}))}function c(){$("div#map").addClass("snapshot"),setTimeout((function(){$("div#map").removeClass("snapshot")}),240)}function d(){$("#basemapModal #basemaps").off("click"),$("#basemapModal #basemaps").click((async function(t){let e=$(t.target).data("basemap");(e||0===e)&&(await _MAP.setBasemap(_BASEMAPS[e].tiles),_SCENES.setBasemap())})),$("#basemapModal button#uploadBasemap").click((function(t){$("#basemapModal input#basemapFile").click()}))}function u(){(0,o.generate_basemaps)(!1),d()}function h(){(0,o.generate_basemaps)(!0),d()}function m(t,e,o){let i=o*e;return i<=t?[i,e]:[t,t/o]}})),parcelRequire.register("4XDZb",(function(t,e){function o(t,e){let o=`\n\t\t<li class="list-group-item p-1 my-1" id="${t}" data-id="${t}">\n\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t<button type="button" class="btn btn-outline-light" id="reorder" title="Change ordering">\n\t\t\t\t\t<i class="fas fa-bars"></i>\n\t\t\t\t</button>\n\t\t\t\t<input type="text" class="form-control" id="title" aria-label="Title" aria-describedby="num" />\n\t\t\t\t<span class="input-group-text" id="num"></span>\n\t\t\t</div>\n\t\t</li>\n\t`;e?$(`li[data-id="${e}"]`).after(o):$("ul#scenes").append(o)}function i(t){let e="";for(let o=0;o<_BASEMAPS.length;o++){let i=_BASEMAPS[o];""!==i.name&&t||(e+=`\n\t\t\t<div class="col">\n\t\t\t\t<div class="card mt-2">\n\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t<h6 class="card-title mb-0">${i.name}</h6>\n\t\t\t\t\t</div>\n\t\t\t\t\t<img class="card-img-bottom" id="basemaps" src="${i.preview}" alt="${i.name}" data-basemap="${o}" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)}t&&(e+=`\n\t\t\t<div class="col">\n\t\t\t\t<div class="card mt-2">\n\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t<div class="d-grid">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-outline-secondary" id="uploadBasemap" ${_USER_PAID?"":"disabled"}>+</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`),$(t?"#basemapModal #imgBasemapChoose":"#basemapModal #basemapChoose").html(e)}function n(){return'\n\t\t<form class="container-fluid objectPopup" id="avatarPopup">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<input type="text" class="form-control form-control-sm" id="label" aria-label="label" placeholder="Label" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<div class="input-group-text">\n\t\t\t\t\t\t\t<input type="checkbox" class="form-check-input mt-0" id="rounded" value="" aria-label="Rounded" title="Rounded" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<input type="number" min="10" max="500" step="1" class="form-control" id="size" placeholder="Size" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="accordion" id="iconAccordion">\n\t\t\t\t\t\t<div class="accordion-item">\n\t\t\t\t\t\t\t<h2 class="accordion-header" id="iconAccordionHeading">\n\t\t\t\t\t\t\t\t<button class="accordion-button collapsed py-1 px-2" type="button" data-bs-toggle="collapse" data-bs-target="#iconAccordionCollapse" aria-expanded="false" aria-controls="iconAccordionCollapse">\n\t\t\t\t\t\t\t\t\tIcon\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t<div id="iconAccordionCollapse" class="accordion-collapse collapse" aria-labelledby="iconAccordionHeading" data-bs-parent="#iconAccordion">\n\t\t\t\t\t\t\t\t<div class="accordion-body py-1" style="max-height: 80px; overflow-y: auto;">\n\t\t\t\t\t\t\t\t\t<div class="row row-cols-5" id="iconChoose">\n\t\t\t\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t\t\t\t<button type="button" class="btn btn-sm btn-outline-secondary" id="iconAdd" title="Add icon">+</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t  </div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<input type="color" class="form-control form-control-color" id="color" value="#563d7c" title="Choose color" />\n\t\t\t\t\t\t<input type="number" min="0" max="10" class="form-control" id="thickness" placeholder="Thickness" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<input type="number" min="0" max="3" step="0.1" class="form-control" id="blur" placeholder="Blur" />\n\t\t\t\t\t\t<input type="number" min="0" max="1" step="0.1" class="form-control" id="grayscale" placeholder="Grayscale" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<input type="number" min="0" max="6" step="1" class="form-control" id="brightness" placeholder="Brightness" />\n\t\t\t\t\t\t<input type="number" min="0" max="0.9" step="0.1" class="form-control" id="transparency" placeholder="Transparency" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row mb-2">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<input type="number" class="form-control form-control-sm" id="animationSpeed" min="0.1" max="10" step="0.1" aria-label="Animation speed" placeholder="Animation speed (sec.)" title="This objects animation speed to next scene" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<button type="button" class="btn btn-sm btn-outline-secondary py-0" id="makeGlobal" title="Save options globally">\n\t\t\t\t\t\t<i class="fas fa-save"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t'}function s(){return'\n\t\t<form class="container-fluid objectPopup" id="shapePopup">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<input type="text" class="form-control form-control-sm" id="label" aria-label="label" placeholder="Label" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<input type="color" class="form-control form-control-color" id="lineColor" value="#563d7c" title="Choose color" />\n\t\t\t\t\t\t<input type="number" min="2" max="10" class="form-control" id="lineThickness" placeholder="Thickness" />\n\t\t\t\t\t\t<input type="number" min="0" max="0.9" step="0.1" class="form-control" id="lineTransparency" placeholder="Transparency" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="form-check mt-1">\n\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" id="dashed">\n\t\t\t\t\t\t<label class="form-check-label" for="dashed">Dashed</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row mb-2">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<input type="number" class="form-control form-control-sm" id="animationSpeed" min="0.1" max="10" step="0.1" aria-label="Animation speed" placeholder="Animation speed (sec.)" title="This objects animation speed to next scene" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<button type="button" class="btn btn-sm btn-outline-secondary py-0" id="makeGlobal" title="Save options globally">\n\t\t\t\t\t\t<i class="fas fa-save"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t'}function a(){return'\n\t\t<form class="container-fluid objectPopup" id="shapePopup">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<input type="text" class="form-control form-control-sm" id="label" aria-label="label" placeholder="Label" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<input type="color" class="form-control form-control-color" id="lineColor" value="#563d7c" title="Choose color" />\n\t\t\t\t\t\t<input type="number" min="2" max="10" class="form-control" id="lineThickness" placeholder="Thickness" />\n\t\t\t\t\t\t<input type="number" min="0" max="0.9" step="0.1" class="form-control" id="lineTransparency" placeholder="Transparency" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="form-check mt-1">\n\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" id="dashed">\n\t\t\t\t\t\t<label class="form-check-label" for="dashed">Dashed</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<input type="color" class="form-control form-control-color" id="fillColor" value="#563d7c" title="Choose color" />\n\t\t\t\t\t\t<input type="number" min="0" max="1" step="0.1" class="form-control" id="fillTransparency" placeholder="Transparency" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row mb-2">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<input type="number" class="form-control form-control-sm" id="animationSpeed" min="0.1" max="10" step="0.1" aria-label="Animation speed" placeholder="Animation speed (sec.)" title="This objects animation speed to next scene" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<button type="button" class="btn btn-sm btn-outline-secondary py-0" id="makeGlobal" title="Save options globally">\n\t\t\t\t\t\t<i class="fas fa-save"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t'}$parcel$export(t.exports,"new_scene",(function(){return o})),$parcel$export(t.exports,"generate_basemaps",(function(){return i})),$parcel$export(t.exports,"avatar_popup",(function(){return n})),$parcel$export(t.exports,"polyline_popup",(function(){return s})),$parcel$export(t.exports,"polygon_popup",(function(){return a}))})),parcelRequire.register("gUPg4",(function(t,e){$parcel$export(t.exports,"Scenes",(function(){return n}));var o=parcelRequire("aykGt"),i=parcelRequire("4XDZb");function n(){this.store=[],this.active="",this.copiedBounds=null,this.setup=function(){$("#scenes").sortable({cursor:"move",handle:"button#reorder",items:"> li",containment:"parent",tolerance:"pointer",cancel:"",zIndex:1003,axis:"x",start:(t,e)=>{t.stopPropagation(),this.unbind()},update:(t,e)=>{t.stopPropagation(),this.reorder($("#scenes").sortable("toArray"))},stop:(t,e)=>{t.stopPropagation(),this.bind()}}),$("#sceneRow button#delete, #sceneRow button#recapture").prop("disabled",!1)},this.reset=function(){$("#scenes").sortable("destroy"),$("#sceneRow button#delete, #sceneRow button#recapture").prop("disabled",!0)},this.get=function(t){for(let e=0;e<this.store.length;e++){let o=Object.assign({},this.store[e]);if(o.id==t)return o.index=e,o}return null},this.getEl=function(t){for(let e=0;e<this.store.length;e++){let o=Object.assign({},this.store[e]);if($(`li[data-id="${o.id}"]`)[0].contains(t))return o.index=e,o}return null},this.getPrevScene=function(t){let e=this.get(t);if(e&&!(e.index<=0))return Object.assign({},this.store[e.index-1])},this.reorder=function(t){this.store.sort(((e,o)=>t.indexOf(e.id)-t.indexOf(o.id))),this.set(this.active)},this.add=function(){this.store.length<=0&&document.dispatchEvent(new Event("_setup"));let t=new s(null,this.active);t.capture(),this.active?this.store.splice(this.get(this.active).index+1,0,t):this.store.push(t),_TEXTBOXES.addScene(t.id),_MAP.addScene(t.id),this.set(t.id),this.bind(),(0,o.save_data)()},this.capture=function(){if(!this.active)return;this.store[this.get(this.active).index].capture(),(0,o.flash_map)(),(0,o.save_data)()},this.delete=function(){if(!this.active)return;let t=this.get(this.active);_TEXTBOXES.deleteScene(t.id),_MAP.deleteScene(t.id),this.prev()||this.next(),this.store.splice(t.index,1),$(`li[data-id="${t.id}"]`).remove(),this.setNumbering(),this.store.length<=0&&(this.active="",document.dispatchEvent(new Event("_reset"))),(0,o.save_data)()},this.unbind=function(){$("#scenes li button#reorder").prop("disabled",!0),$("#scenes li").off("click")},this.bind=function(){$("#scenes li button#reorder").prop("disabled",!1),$("#scenes li").off("click"),$("#scenes li").click((t=>{let e=this.getEl(t.target);e&&($(`li[data-id="${e.id}"]`).hasClass("active")||this.set(e.id))}))},this.prev=function(){let t=this.get(this.active);if(t&&!(t.index<=0))return t=this.store[t.index-1],this.set(t.id),Object.assign({},t)},this.current=function(){this.set(this.active),this.bind()},this.next=function(){let t=this.get(this.active);if(t&&!(t.index>=this.store.length-1))return t=this.store[t.index+1],this.set(t.id),Object.assign({},t)},this.set=function(t){this.active&&this.get(this.active).disable(),this.active=t;let e=this.get(t);e.enable(),$(`li[data-id="${e.id}"]`)[0].scrollIntoView({behavior:"smooth",inline:"center"}),_TEXTBOXES.set(e.id),_MAP.set(e.id),this.setNumbering()},this.setWMS=function(){this.store[this.get(this.active).index].setWMS()},this.setBasemap=function(){this.store[this.get(this.active).index].setBasemap()},this.setBookmark=function(t){if(!this.active)return;this.store[this.get(this.active).index].setBookmark(t),(0,o.save_data)()},this.setNumbering=function(){let t=1;for(let e of $("#scenes li span#num"))$(e).html(t++)},this.copyBounds=function(){this.active&&(this.copiedBounds=this.get(this.active).bounds)},this.pasteBounds=function(){if(!this.active)return;this.store[this.get(this.active).index].setBounds(this.copiedBounds)},this.importData=function(t){if(!(t.length<=0)){(this.store.length<=0||!this.active)&&(this.active=t[0].id);for(let e of t){let t=new s(e.id);t.bounds=e.bounds,t.wms=e.wms,t.basemap=e.basemap,t.setBookmark(e.bookmark),t.setTitle(e.title),t.disable(),this.store.push(t)}}},this.exportData=function(){let t=[];for(let e of this.store)t.push(e.exportData());return t}}function s(t,e){this.id=t||(0,o.uuid)(),this.bounds=null,this.wms=null,this.basemap=null,this.bookmark=!1,this.title="",(0,i.new_scene)(this.id,e),$(`li[data-id="${this.id}"]`).on("keydown keyup",(t=>{t.stopPropagation()})),$(`li[data-id="${this.id}"] input#title`).change((t=>{this.title=t.target.value})),this.enable=function(){$(`li[data-id="${this.id}"]`).addClass("active"),$(`li[data-id="${this.id}"] input, li[data-id="${this.id}"] button`).prop("disabled",!1),$(`li[data-id="${this.id}"] input, li[data-id="${this.id}"] button`).click((t=>{t.stopPropagation()}))},this.disable=function(){$(`li[data-id="${this.id}"]`).removeClass("active"),$(`li[data-id="${this.id}"] input`).prop("disabled",!0),$(`li[data-id="${this.id}"] input, li[data-id="${this.id}"] button`).off("click")},this.setBounds=function(t){this.bounds=t,_MAP.setFlyTo(this.bounds)},this.setWMS=function(){this.wms=_MAP.getWMS()},this.setBasemap=function(){this.basemap=_MAP.getBasemap()},this.setBookmark=function(t){this.bookmark=t,t?$(`li[data-id="${this.id}"]`).addClass("bookmark"):$(`li[data-id="${this.id}"]`).removeClass("bookmark")},this.setTitle=function(t){this.title=t,$(`li[data-id="${this.id}"] input#title`).val(this.title)},this.capture=function(){let t=_MAP.getBounds().getNorthWest(),e=_MAP.getBounds().getSouthEast();this.setBounds([[t.lat,t.lng],[e.lat,e.lng]]),this.setBasemap()},this.exportData=function(){return{id:this.id,bounds:this.bounds,wms:this.wms,basemap:this.basemap,bookmark:this.bookmark,title:this.title}}}})),parcelRequire.register("aDjZZ",(function(t,e){$parcel$export(t.exports,"Textboxes",(function(){return i}));var o=parcelRequire("aykGt");function i(){this.store=[],$("input#_img_textbox").change((function(t){let e=$(this)[0].files[0];if(!e)return;$("#loadingModal").modal("show");let o=new FormData;o.append("op","upload_create"),o.append("type","image"),o.append("image",e),$.ajax({type:"POST",url:"api.php",data:o,contentType:!1,processData:!1,success:function(t,e,o){$("#textbox #content").trumbowyg("execCmd",{cmd:"insertImage",param:t,forceCss:!1,skipTrumbowyg:!0}),setTimeout((function(){$("#loadingModal").modal("hide")}),750)},error:function(t,e,o){console.log(t.status,o),setTimeout((function(){$("#loadingModal").modal("hide"),$("#errorModal").modal("show")}),750)}})})),$("#textbox input#lock").change((t=>{this.setLock(t.target.checked)})),$("#textbox button#close").click((t=>{this.delete(_SCENES.active)})),$("#textboxOptionsModal select#bookOrientation").change((t=>{this.setOrientation(t.target.value)})),this.setup=function(){$("#textbox").resizable({containment:"#mapRow",handles:"e",minWidth:100,stop:(t,e)=>{let o=e.size.width/($("#mapRow").outerWidth()-20),i=this.get(_SCENES.active);i&&(this.store[i.index].dim=[0,o],$("#textbox").css({width:100*o+"%"}),"right"==i.pos&&$("#textbox").css({left:"auto"}))}}),$("#textbox #content").trumbowyg({autogrow:!0,semantic:!1,resetCss:!0,removeformatPasted:!0,urlProtocol:!0,defaultLinkTarget:"_blank",tagsToRemove:["script","link"],btnsDef:{format:{dropdown:["bold","italic","underline","del"],title:"Format",ico:"bold"},align:{dropdown:["justifyLeft","justifyCenter","justifyRight","justifyFull","unorderedList","orderedList"],title:"List/Align",ico:"justifyLeft"},uploadImg:{fn:t=>{$("input#_img_textbox").click()},title:"Add image",ico:"insertImage"},makeLink:{fn:t=>{$("#textbox #content").trumbowyg("saveRange");let e=$("#textbox #content").trumbowyg("getRangeText");""!=e.replace(/\s/g,"")&&(["http","https"].indexOf(e.split("://")[0])<0&&(e=`https://${e}`),$("#textbox #content").trumbowyg("execCmd",{cmd:"insertHTML",param:`<a href="${e}" target="_blank">${e}</a>`,forceCss:!1}))},title:"Create link",ico:"link"}},btns:[["formatting"],["format"],["align"],["fontfamily"],["foreColor","backColor"],["makeLink"],["uploadImg"]],plugins:{}}).on("tbwchange",(()=>{let t=this.get(_SCENES.active);t&&(this.store[t.index].content=$("#textbox #content").trumbowyg("html"))})),_MAP.setOrientation("right")},this.reset=function(){$("#textbox").resizable("destroy"),$("#textbox #content").trumbowyg("destroy"),_MAP.setOrientation("right")},this.get=function(t){for(let e=0;e<this.store.length;e++){let o=Object.assign({},this.store[e]);if(o.sceneId==t)return o.index=e,o}return null},this.add=function(){if(!_SCENES.active)return;let t=new n(null);t.sceneId=_SCENES.active,t.enable(),this.store.push(t),(0,o.save_data)()},this.addScene=function(t){let e=_SCENES.getPrevScene(t);if(e)for(let o of this.store)if(o.sceneId==e.id&&o.locked){let e=new n(null);e.sceneId=t,e.pos=o.pos,e.dim=o.dim,e.content=o.content,e.locked=!0,e.enable(),this.store.push(e);break}},this.delete=function(t){let e=this.get(t);e&&(e.disable(),this.store.splice(e.index,1),(0,o.save_data)())},this.deleteScene=function(t){for(let e of this.store)e.sceneId==t&&this.delete(e.sceneId)},this.set=function(t){for(let e of this.store){if(e.sceneId==t){e.enable();break}e.disable()}},this.setLock=function(t){let e=this.get(_SCENES.active);e&&this.store[e.index].setLock(t)},this.setOrientation=function(t){let e=this.get(_SCENES.active);e&&(this.store[e.index].pos=t,this.store[e.index].setOrientation())},this.importData=function(t){if(!(t.length<=0))for(let e of t){let t=new n(e.id);t.sceneId=e.sceneId,e.pos&&(t.pos=e.pos),e.dim&&(t.dim=e.dim),t.content=e.content,t.locked=e.locked,t.disable(),this.store.push(t)}},this.exportData=function(){let t=[];for(let e of this.store)t.push(e.exportData());return t}}function n(t){this.id=t||(0,o.uuid)(),this.sceneId="",this.locked=!1,this.pos="left",this.dim=[0,.25],this.content="",this.setOrientation=function(){switch(this.pos){case"left":$("#textbox").css({left:"10px",right:"auto"}),$("#textbox").resizable("option",{handles:"e"}),_MAP.setOrientation("right");break;case"right":$("#textbox").css({left:"auto",right:"10px"}),$("#textbox").resizable("option",{handles:"w"}),_MAP.setOrientation("left")}},this.setLock=function(t){this.locked=t,$("#textbox input#lock").prop("checked",this.locked)},this.enable=function(){this.setOrientation(),$("#textbox").css("display","block"),$("#textbox").css({width:100*this.dim[1]+"%"}),$("#textbox #content").trumbowyg("enable"),$("#textbox #content").trumbowyg("html",this.content),$("#textbox #lock").prop({disabled:!1,checked:this.locked}),_MAP.textboxButton.disable()},this.disable=function(){$("#textbox").css("display","none"),$("#textbox #content").trumbowyg("disable"),$("#textbox #lock").prop("disabled",!0),_MAP.textboxButton.enable()},this.exportData=function(){return{id:this.id,sceneId:this.sceneId,locked:this.locked,pos:this.pos,dim:this.dim,content:this.content}}}})),parcelRequire.register("4mhKw",(function(t,e){var o=parcelRequire("aykGt"),i=parcelRequire("4XDZb"),n=parcelRequire("5WMrM");L.Map.addInitHook((function(){this.setAspectRatio(),this.returnButton=L.Control.zoomHome({position:"bottomright",zoomHomeIcon:"home",zoomHomeTitle:"Return to map-extent"}),this.addControl(this.returnButton),this.basemapButton=L.easyButton({id:"changeBasemap",position:"bottomright",leafletClasses:!0,states:[{stateName:"main",onClick:function(t,e){$("#basemapModal").modal("show"),(0,o.init_img_basemaps)()},title:"Change basemap",icon:"fa-layer-group"}]}),this.addControl(this.basemapButton),this.basemapButton.disable(),this.textboxButton=L.easyButton({id:"addTextbox",position:"topleft",leafletClasses:!0,states:[{stateName:"main",onClick:function(t,e){_TEXTBOXES.add()},title:"Add book",icon:"fa-comment-alt"}]}),this.addControl(this.textboxButton),this.textboxButton.disable(),this.basemap=_BASEMAPS[10].tiles,this.addLayer(this.basemap),this.wms={},this.pm.addControls({position:"topright",drawCircleMarker:!1,drawText:!1,oneBlock:!0}),this.pm.setPathOptions({weight:3,color:"#563d7c",opacity:1,fillColor:"#563d7c",fillOpacity:.2}),this.pm.setGlobalOptions({markerStyle:{icon:L.icon({iconUrl:"assets/user-circle-solid.svg",iconSize:[30,30],popupAnchor:[0,-15],tooltipAnchor:[0,15]})}}),this.pm.setLang("customLang",{tooltips:{placeMarker:"Click to place avatar"},buttonTitles:{drawMarkerButton:"Draw avatar"}},"en"),this.disableDraw(),this.objects=[],this.fadeLayer=L.fadeLayer({pmIgnore:!0}),this.addLayer(this.fadeLayer),this.on("pm:create",(t=>{let e=t.layer;if("Marker"==t.shape){let t=this.getZoom(),o=this.project(e.getLatLng(),t),i=e.getIcon().options.iconUrl,n=e.getIcon().options.iconSize;this.removeLayer(e),e=L.imageOverlay(i,[this.unproject([o.x-n[0]/2,o.y-n[1]/2],t),this.unproject([o.x+n[0]/2,o.y+n[1]/2],t)],{interactive:!0,zIndex:200,ratio:.96875,rounded:!1,angle:0,borderColor:"#563d7c",borderThickness:0,overlayBlur:0,overlayGrayscale:0,overlayBrightness:0,overlayTransparency:0}),this.addLayer(e)}e.options.id=(0,o.uuid)(),e.options.sceneId=_SCENES.active,this.fire("_addedlayer",{layer:e}),this.objects.push(this.extractObject(e))})),this.on("_addedlayer",(async t=>{let e=t.layer,o=e.options.label;o&&(e.bindTooltip(o,{direction:"center",permanent:!0}),e instanceof L.ImageOverlay&&this.updateTooltip(e)),e.on("moveend",(t=>{this.updateTooltip(t.target)})),e.on("pm:edit",(t=>{let e=t.layer;this.updateObject(e),e.options.label&&(e.closeTooltip(),e.openTooltip())})),e.on("pm:remove",(t=>{let e=t.layer;this.deleteObject(e),e.closeTooltip(),e.unbindTooltip(),e.closePopup(),e.unbindPopup(),e.off("popupopen"),e.off("mouseover"),e.off("mouseout"),e.slideCancel()})),this.setPopup(e),e.on("pm:dragstart",(t=>{e.unbindPopup()})),e.on("pm:dragend",(t=>{this.setPopup(t.layer)})),e.on("popupopen",(t=>{(0,n.bind_setup)(e)})),e.on("mouseover",(t=>{this.highlightObject(e.options.id)})),e.on("mouseout",(t=>{this.unhighlightObject(e.options.id)}));let i=[{text:"Move to front",callback:t=>{e.bringToFront()},index:0},{text:"Move to back",callback:t=>{e.bringToBack()},index:1}];e instanceof L.ImageOverlay&&(i.push({text:"Clone avatar",callback:t=>{this.cloneAvatar(e.options.id,e.options.sceneId)},index:2}),this.setIcon(e)),e.bindContextMenu({contextmenu:!0,contextmenuItems:i})})),this.on("layeradd",(t=>{t.layer})),this.on("zoomend",(t=>{for(let t of this.getLayers())this.updateTooltip(t)})),this.on("zoom",(t=>{this._renderer&&this._renderer._reset()})),this.on("movestart",(t=>{})),this.on("moveend",(t=>{}))})),L.Map.include({setup:function(){this.setAspectRatio(),this.enableDraw(),this.basemapButton.enable(),this.textboxButton.enable(),$("div.leaflet-control-attribution a").prop("target","_blank")},reset:function(){this.clearLayers(),this.fadeLayer.clearLayers(),this.disableDraw(),this.basemapButton.disable(),this.textboxButton.disable()},enableDraw:function(){this.pm.Toolbar.setButtonDisabled("Marker",!1),this.pm.Toolbar.setButtonDisabled("Line",!1),this.pm.Toolbar.setButtonDisabled("Polygon",!1),this.pm.Toolbar.setButtonDisabled("Rectangle",!1),this.pm.Toolbar.setButtonDisabled("Circle",!1),this.pm.Toolbar.setButtonDisabled("Edit",!1),this.pm.Toolbar.setButtonDisabled("Drag",!1),this.pm.Toolbar.setButtonDisabled("Cut",!1),this.pm.Toolbar.setButtonDisabled("Removal",!1),this.pm.Toolbar.setButtonDisabled("Rotate",!1)},disableDraw:function(){this.pm.Toolbar.setButtonDisabled("Marker",!0),this.pm.Toolbar.setButtonDisabled("Line",!0),this.pm.Toolbar.setButtonDisabled("Polygon",!0),this.pm.Toolbar.setButtonDisabled("Rectangle",!0),this.pm.Toolbar.setButtonDisabled("Circle",!0),this.pm.Toolbar.setButtonDisabled("Edit",!0),this.pm.Toolbar.setButtonDisabled("Drag",!0),this.pm.Toolbar.setButtonDisabled("Cut",!0),this.pm.Toolbar.setButtonDisabled("Removal",!0),this.pm.Toolbar.setButtonDisabled("Rotate",!0)},setOrientation:function(t){switch(t){case"left":this.returnButton.setPosition("bottomleft"),this.basemapButton.setPosition("bottomleft"),this.pm.Toolbar.setBlockPosition("draw","topleft"),this.pm.Toolbar.setBlockPosition("edit","topleft"),this.textboxButton.setPosition("topright");break;case"right":this.returnButton.setPosition("bottomright"),this.basemapButton.setPosition("bottomright"),this.pm.Toolbar.setBlockPosition("draw","topright"),this.pm.Toolbar.setBlockPosition("edit","topright"),this.textboxButton.setPosition("topleft")}},setHomeBounds:function(t){this.returnButton&&this.returnButton.setHomeBounds(t,{maxZoom:this.getMaxZoom()})},setAspectRatio:function(t){t&&(_OPTIONS.aspectratio=t);let e=$("#mapRow").outerWidth(),i=$("#mapRow").outerHeight(),n=_OPTIONS.aspectratio,s=(0,o.get_aspect_ratio_dimentions)(e,i,n);$("#map").css({width:s[0]/e*100+"%",height:`calc(${s[1]/i*100}% - 39px - 49px)`,left:(e-s[0])/2/e*100+"%",top:`calc(${(i-s[1])/2/i*100}% + 39px + 49px)`}),this.invalidateSize(),_SCENES.active&&this.setFlyTo(_SCENES.get(_SCENES.active).bounds)},setFlyTo:function(t){this.flyToBounds(t,{maxZoom:this.getMaxZoom(),noMoveStart:!0,duration:_OPTIONS.panningspeed||null}),this.setHomeBounds(t)},clearLayers:function(){for(let t of this.getLayers())this.removeLayer(t)},getLayers:function(){return this.pm.getGeomanLayers()},addScene:function(t){let e=_SCENES.getPrevScene(t);if(!e||!_OPTIONS.objectOptIn)return;let o=e.id;for(let e of this.objects)if(e.sceneId==o){let o=Object.assign({},e);o.sceneId=t,this.objects.push(o)}_SCENES.store[_SCENES.get(t).index].setWMS()},deleteScene:function(t){this.objects=this.objects.filter((e=>e.sceneId!=t))},highlightObject:function(t){let e=this.fadeLayer.getObject(t);e&&(e instanceof L.ImageOverlay?e.setOpacity(.8):e.setStyle({opacity:.8}))},unhighlightObject:function(t){let e=this.fadeLayer.getObject(t);e&&(e instanceof L.ImageOverlay?e.setOpacity(.3):e.setStyle({opacity:.3}))},setObjects:function(t){let e=_SCENES.getPrevScene(t),o=e?e.id:null;if(this.fadeLayer.clearLayers(),o)for(let t of this.objects)t.sceneId==o&&this.fadeLayer.addLayer(this.createObject(t),t.id);let i=this.getLayers().map((t=>{let e=this.extractObject(t);return{id:e.id,pos:e.pos,radius:e.radius,animationspeed:e.animationspeed}}));this.clearLayers();for(let e=0;e<this.objects.length;e++){let o=Object.assign({},this.objects[e]);if(o.sceneId==t){let t=o.pos,e=o.radius;for(let t of i)if(o.id==t.id){o.pos=t.pos,"circle"==o.type&&(o.radius=t.radius);break}let n=this.createObject(o);this.addLayer(n),this.fire("_addedlayer",{layer:n});for(let s of i)if(o.id==s.id){n.slideTo(t,{radius:e,duration:s.animationspeed||_OPTIONS.animationspeed});break}}}},set:function(t){let e=_SCENES.get(t);this.setBasemap(e.basemap),this.setWMS(e.wms),this.setObjects(t),this.setFlyTo(e.bounds)},insertObject:function(t){for(let e of this.getLayers())if(e.options.id==t.options.id)return;let e;for(let o of this.objects)if(o.id==t.options.id&&o.sceneId==t.options.sceneId){e=Object.assign({},o);break}e.sceneId=_SCENES.active;let o=this.createObject(e);this.addLayer(o),this.fire("_addedlayer",{layer:o}),this.objects.push(e)},cloneAvatar:function(t,e){let i;for(let o of this.objects)if(o.id==t&&o.sceneId==e){i=Object.assign({},o);break}i.id=(0,o.uuid)();let n=this.getZoom(),s=this.project(i.pos[0],n),a=this.project(i.pos[1],n);s.x+=50,s.y+=50,a.x+=50,a.y+=50,s=this.unproject(s,n),a=this.unproject(a,n),i.pos=[[s.lat,s.lng],[a.lat,a.lng]];let r=this.createObject(i);this.addLayer(r),this.fire("_addedlayer",{layer:r}),this.objects.push(i)},updateObject:function(t){for(let e=0;e<this.objects.length;e++){let o=this.objects[e];if(o.id==t.options.id&&o.sceneId==t.options.sceneId){this.objects[e]=this.extractObject(t);break}}},deleteObject:function(t){for(let e=0;e<this.objects.length;e++){let o=this.objects[e];if(o.id==t.options.id&&o.sceneId==t.options.sceneId){this.objects.splice(e,1);break}}},globalObjectOptions:function(t){let e=this.extractObject(t);delete e.id,delete e.sceneId,delete e.type,delete e.pos,t instanceof L.Circle&&delete e.radius;for(let o=0;o<this.objects.length;o++){let i=this.objects[o];i.id==t.options.id&&i.sceneId!=t.options.sceneId&&(this.objects[o]=Object.assign({},i,e))}if(t=this.fadeLayer.getObject(t.options.id)){this.fadeLayer.removeLayer(t);let o=Object.assign({},this.extractObject(t),e);this.fadeLayer.addLayer(this.createObject(o),o.id)}},setIcon:function(t,e,o){if(t instanceof L.ImageOverlay){if(e){let o=this.getZoom(),i=this.project(t.getBounds().getCenter(),o);t.setBounds([this.unproject([i.x-e[0]/2,i.y-e[1]/2],o),this.unproject([i.x+e[0]/2,i.y+e[1]/2],o)])}o&&t.setUrl(o),$(t._image).css("border-radius",t.options.rounded?"50%":"0"),$(t._image).css("border",`${t.options.borderThickness}px solid ${t.options.borderColor}`),$(t._image).css("filter",`\n\t\t\tblur(${t.options.overlayBlur}px)\n\t\t\tgrayscale(${100*t.options.overlayGrayscale}%)\n\t\t\tdrop-shadow(0 0 ${t.options.overlayBrightness}px yellow)\n\t\t\topacity(${100*(1-t.options.overlayTransparency)}%)\n\t\t`),t.options.label&&this.updateTooltip(t)}},setPopup:function(t){t.unbindPopup();let e=t instanceof L.ImageOverlay?(0,i.avatar_popup)():t instanceof L.Rectangle||t instanceof L.Polygon||t instanceof L.Circle?(0,i.polygon_popup)():t instanceof L.Polyline?(0,i.polyline_popup)():"";e&&t.bindPopup(e,{keepInView:!0,closeOnEscapeKey:!1,maxWidth:350,maxHeight:450})},updateTooltip:function(t){if(t.getTooltip()){if(t.closeTooltip(),t instanceof L.ImageOverlay){let e=this.latLngToContainerPoint(t.getBounds().getNorthWest()).distanceTo(this.latLngToContainerPoint(t.getBounds().getSouthWest()));t.getTooltip().options.offset=[0,e/2-10]}t.openTooltip()}},getWMS:function(){return this.wms?{type:"wms",url:this.wms._url,layers:this.wms.options.layers,format:this.wms.options.format,version:this.wms.options.version,transparent:this.wms.options.transparent}:null},setWMS:function(t){if(!t)return void(this.wms=this.wms?this.removeLayer(this.wms):null);if(this.wms&&(t.url||t._url)==this.wms._url&&(t.layers||t.options.layers)==this.wms.options.layers&&(t.format||t.options.format)==this.wms.options.format&&(t.version||t.options.version)==this.wms.options.version)return;let e;if(t instanceof L.TileLayer.WMS)e=t;else{if("wms"!=t.type)return;e=L.tileLayer.wms(t.url,{layers:t.layers,format:t.format,transparent:t.transparent,version:t.version,minZoom:t.minZoom||0,maxZoom:t.maxZoom||22,attribution:t.attribution||""})}this.wms&&this.removeLayer(this.wms),this.wms=e,this.addLayer(this.wms),this.wms.bringToFront()},getCenterBasemapTile:function(){if(this.basemap instanceof L.ImageOverlay)return this.basemap._url;let t=this.basemap.getTileSize(),e=this.project(this.getCenter(),this.getZoom()),o="";try{o=this.basemap.getTileUrl({x:Math.floor(e.x/t.x),y:Math.floor(e.y/t.y)})}catch(t){console.error(t)}return o},getBasemap:function(){return this.basemap instanceof L.TileLayer?{type:"tiles",url:this.basemap._url,minZoom:this.basemap.options.minZoom,maxZoom:this.basemap.options.maxZoom,attribution:this.basemap.options.attribution}:this.basemap instanceof L.ImageOverlay?{type:"image",img:this.basemap._url}:null},setBasemap:async function(t){let e;if(t instanceof L.TileLayer){if(this.basemap instanceof L.TileLayer&&t._url==this.basemap._url)return;e=t}else if("tiles"==t.type){if(this.basemap instanceof L.TileLayer&&t.url==this.basemap._url)return;e=L.tileLayer(t.url,{minZoom:t.minZoom||0,maxZoom:t.maxZoom||22,attribution:t.attribution||`&copy; <a href="https://${_HOST}" target="_blank">GeoTales</a>`})}else{if("image"!=t.type)return;{if(this.basemap instanceof L.ImageOverlay&&t.img==this.basemap._url)return;let o=new Image;o.src=t.img,await o.decode();let i=o.width/o.height,n=_SCENES.get(_SCENES.active).bounds,s=[n[0],[]],a=this.latLngToContainerPoint(n[0]),r=this.latLngToContainerPoint(n[1]),l=r.y-a.y,p=r.x-a.x;if(i>=1){let t=this.containerPointToLatLng([r.x,a.y+p/i]);s[1][0]=t.lat,s[1][1]=t.lng}else{let t=this.containerPointToLatLng([a.x+i*l,r.y]);s[1][0]=t.lat,s[1][1]=t.lng}e=L.imageOverlay(t.img,s,{pmIgnore:!0,zIndex:0,minZoom:0,maxZoom:1e3,attribution:`&copy; <a href="https://${_HOST}" target="_blank">GeoTales</a>`})}}this.removeLayer(this.basemap),this.basemap=e,this.presetZoom(this.basemap.options.minZoom,this.basemap.options.maxZoom),this.addLayer(this.basemap),this.basemap.bringToBack(),$("div.leaflet-control-attribution a").prop("target","_blank"),(0,o.save_data)()},resetBasemap:function(){this.setBasemap(_BASEMAPS[10].tiles)},presetZoom:function(t,e){let o=this.getZoom();(o<t||o>e)&&(o<t&&this.setZoom(t),o>e&&this.setZoom(e)),this.setMinZoom(t),this.setMaxZoom(e)},createObject:function(t){let e=null;switch(t.type){case"avatar":e=L.imageOverlay(t.icon,t.pos,{interactive:!0,zIndex:200,label:t.label,ratio:t.ratio,rounded:t.rounded,angle:t.angle,borderColor:t.borderColor,borderThickness:t.borderThickness,overlayBlur:t.blur,overlayBrightness:t.brightness,overlayGrayscale:t.grayscale,overlayTransparency:t.transparency,animationspeed:t.animationspeed});break;case"polyline":e=L.polyline(t.pos,{label:t.label,dashArray:t.dashed?"5, 10":"",color:t.color,weight:t.thickness,opacity:1-t.transparency,animationspeed:t.animationspeed});break;case"polygon":e=L.polygon(t.pos,{label:t.label,dashArray:t.dashed?"5, 10":"",color:t.lineColor,weight:t.lineThickness,opacity:1-t.lineTransparency,fillColor:t.fillColor,fillOpacity:1-t.fillTransparency,animationspeed:t.animationspeed});break;case"rectangle":e=L.rectangle(t.pos,{label:t.label,dashArray:t.dashed?"5, 10":"",color:t.lineColor,weight:t.lineThickness,opacity:1-t.lineTransparency,fillColor:t.fillColor,fillOpacity:1-t.fillTransparency,animationspeed:t.animationspeed});break;case"circle":e=L.circle(t.pos,{radius:t.radius,label:t.label,dashArray:t.dashed?"5, 10":"",color:t.lineColor,weight:t.lineThickness,opacity:1-t.lineTransparency,fillColor:t.fillColor,fillOpacity:1-t.fillTransparency,animationspeed:t.animationspeed});break;default:console.error("object type invalid")}return e.options.id=t.id,e.options.sceneId=t.sceneId,e},extractObject:function(t){let e=null;if(t instanceof L.ImageOverlay){let o=t.getBounds().getNorthWest(),i=t.getBounds().getSouthEast();e={id:t.options.id,sceneId:t.options.sceneId,type:"avatar",pos:[[o.lat,o.lng],[i.lat,i.lng]],label:t.options.label,icon:t._url,ratio:t.options.ratio,rounded:t.options.rounded,angle:0,borderColor:t.options.borderColor,borderThickness:t.options.borderThickness,blur:t.options.overlayBlur,grayscale:t.options.overlayGrayscale,brightness:t.options.overlayBrightness,transparency:t.options.overlayTransparency,animationspeed:t.options.animationspeed}}else if(t instanceof L.Polygon)e={id:t.options.id,sceneId:t.options.sceneId,type:t instanceof L.Rectangle?"rectangle":"polygon",pos:t.getLatLngs(),label:t.options.label,dashed:!!t.options.dashArray,lineColor:t.options.color,lineThickness:t.options.weight,lineTransparency:1-t.options.opacity,fillColor:t.options.fillColor,fillTransparency:1-t.options.fillOpacity,animationspeed:t.options.animationspeed};else if(t instanceof L.Polyline)e={id:t.options.id,sceneId:t.options.sceneId,type:"polyline",pos:t.getLatLngs(),label:t.options.label,dashed:!!t.options.dashArray,color:t.options.color,thickness:t.options.weight,transparency:1-t.options.opacity,animationspeed:t.options.animationspeed};else if(t instanceof L.Circle){let o=t.getLatLng();e={id:t.options.id,sceneId:t.options.sceneId,type:"circle",pos:[o.lat,o.lng],radius:t.getRadius(),label:t.options.label,dashed:!!t.options.dashArray,lineColor:t.options.color,lineThickness:t.options.weight,lineTransparency:1-t.options.opacity,fillColor:t.options.fillColor,fillTransparency:1-t.options.fillOpacity,animationspeed:t.options.animationspeed}}else console.error("object type invalid");return e},importData:function(t){for(let e=0;e<t.length;e++)this.objects.push(t[e])},exportData:function(){return this.objects}})})),parcelRequire.register("5WMrM",(function(t,e){function o(t){if($(".objectPopup input#label").change((function(e){let o=$(this).val();o?(t.getTooltip()||(t.bindTooltip(L.tooltip({direction:"center",permanent:!0},t)),t instanceof L.ImageOverlay&&_MAP.updateTooltip(t)),t.setTooltipContent(o)):t.unbindTooltip(),t.options.label=o,_MAP.updateObject(t)})),$(".objectPopup input#label").val(t.options.label||""),t instanceof L.ImageOverlay){$("#avatarPopup #iconChoose #iconCol").remove();for(let t of _ICONS.slice().reverse())$("#avatarPopup #iconChoose").prepend(`\n\t\t\t\t<div class="col" id="iconCol">\n\t\t\t\t\t<img class="img-fluid rounded" id="icons" src="${t}" alt="&nbsp;" />\n\t\t\t\t</div>\n\t\t\t`);$("input#_img_icon").off("change"),$("input#_img_icon").change((function(e){let o=$(this)[0].files[0];if(!o)return;$("#loadingModal").modal("show");let i=new FileReader;i.onload=async function(){let e=new Image;e.src=i.result,await e.decode(),$("#avatarPopup input#rounded").prop("checked",!1),t.options.ratio=e.width/e.height||1,t.options.rounded=!1,t.options.angle=0;let n=new FormData;n.append("op","upload_create"),n.append("type","icon"),n.append("image",o),$.ajax({type:"POST",url:"api.php",data:n,contentType:!1,processData:!1,success:function(e,o,i){_ICONS.unshift(e),_MAP.setIcon(t,[35,35/t.options.ratio],e),_MAP.updateObject(t),setTimeout((function(){$("#loadingModal").modal("hide")}),750)},error:function(t,e,o){console.error(t.status,o),setTimeout((function(){$("#loadingModal").modal("hide"),$("#errorModal").modal("show")}),750)}})},i.readAsDataURL(o)})),$("#avatarPopup #iconChoose #iconAdd").click((t=>{$("input#_img_icon").click()})),$("#avatarPopup #iconChoose #icons").click((async function(e){let o=$(this).prop("src"),i=new Image;i.src=o,await i.decode(),t.options.ratio=i.width/i.height||1,_MAP.setIcon(t,[35,35/t.options.ratio],o),_MAP.updateObject(t)})),$("#avatarPopup input#size").change((function(e){let o=Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"));_MAP.setIcon(t,[o,o/t.options.ratio]),_MAP.updateObject(t)})),$("#avatarPopup input#rounded").change((function(e){t.options.rounded=this.checked,_MAP.updateObject(t),_MAP.setIcon(t)})),$("#avatarPopup input#rounded").prop("checked",t.options.rounded),$("#avatarPopup input#color").change((function(e){let o=$(this).val();t.options.borderColor=o,_MAP.updateObject(t),_MAP.setIcon(t)})),$("#avatarPopup input#color").val(t.options.borderColor||"#563d7c"),$("#avatarPopup input#thickness").change((function(e){let o=Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"));t.options.borderThickness=o,_MAP.updateObject(t),_MAP.setIcon(t)})),$("#avatarPopup input#blur").change((function(e){let o=Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"));t.options.overlayBlur=o,_MAP.updateObject(t),_MAP.setIcon(t)})),$("#avatarPopup input#grayscale").change((function(e){let o=Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"));t.options.overlayGrayscale=o,_MAP.updateObject(t),_MAP.setIcon(t)})),$("#avatarPopup input#brightness").change((function(e){let o=Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"));t.options.overlayBrightness=o,_MAP.updateObject(t),_MAP.setIcon(t)})),$("#avatarPopup input#transparency").change((function(e){let o=Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"));t.options.overlayTransparency=o,_MAP.updateObject(t),_MAP.setIcon(t)}))}else t instanceof L.Path?($("#shapePopup input#dashed").change((function(e){t.setStyle({dashArray:this.checked?"5, 10":""}),_MAP.updateObject(t)})),$("#shapePopup input#dashed").prop("checked",!!t.options.dashArray),$("#shapePopup input#lineColor").change((function(e){t.setStyle({color:$(this).val()}),_MAP.updateObject(t)})),$("#shapePopup input#lineColor").val(t.options.color||"#563d7c"),$("#shapePopup input#lineThickness").change((function(e){t.setStyle({weight:Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"))}),_MAP.updateObject(t)})),$("#shapePopup input#lineTransparency").change((function(e){t.setStyle({opacity:1-Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"))}),_MAP.updateObject(t)})),(t instanceof L.Rectangle||t instanceof L.Polygon||t instanceof L.Circle)&&($("#shapePopup input#fillColor").change((function(e){t.setStyle({fillColor:$(this).val()}),_MAP.updateObject(t)})),$("#shapePopup input#fillColor").val(t.options.fillColor||"#563d7c"),$("#shapePopup input#fillTransparency").change((function(e){t.setStyle({fillOpacity:1-Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"))}),_MAP.updateObject(t)})))):console.error("object type invalid");$(".objectPopup input#animationSpeed").change((function(e){t.options.animationspeed=1e3*Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max")),_MAP.updateObject(t)})),$(".objectPopup #makeGlobal").click((function(e){_MAP.globalObjectOptions(t)}))}$parcel$export(t.exports,"bind_setup",(function(){return o})),L.FadeLayer=L.FeatureGroup.extend({addLayer:function(t,e){L.FeatureGroup.prototype.addLayer.call(this,t),e&&!t.options.id&&(t.options.id=e),t.options.pmIgnore=!0,t instanceof L.ImageOverlay?(t.setOpacity(.3),$(t._image).css("border-radius",t.options.rounded?"50%":"0"),$(t._image).css("border",`${t.options.borderThickness}px solid ${t.options.borderColor}`),$(t._image).css("filter",`\n\t\t\t\tblur(${t.options.overlayBlur}px)\n\t\t\t\tgrayscale(${100*t.options.overlayGrayscale}%)\n\t\t\t`)):(t.setStyle({opacity:.3}),t.setStyle({fillOpacity:.2})),t.on("click",(e=>{_MAP.insertObject(t)}))},getObject:function(t){for(let e of this.getLayers())if(e.options.id==t)return e;return null},removeLayer:function(t,e){(t=t||(e?this.getObject(e):null))&&(t.off("click"),L.FeatureGroup.prototype.removeLayer.call(this,t))},initialize:function(t){L.FeatureGroup.prototype.initialize.call(this),this.options.id="0",this.options=Object.assign({},this.options,t)}}),L.fadeLayer=function(t){return new L.FadeLayer(t)},L.ImageOverlay.include({__toGeoJSON:function(){if(!this._map)return;let t=this.getBounds().getNorthWest(),e=this.getBounds().getSouthEast();return{type:"Feature",properties:{type:"avatar",label:this.options.label,icon:this._url,ratio:this.options.ratio,rounded:this.options.rounded,angle:0,borderColor:this.options.borderColor,borderThickness:this.options.borderThickness,blur:this.options.overlayBlur,grayscale:this.options.overlayGrayscale,brightness:this.options.overlayBrightness,transparency:this.options.overlayTransparency},geometry:{type:"Polygon",coordinates:[[t.lat,t.lng],[e.lat,e.lng]]}}}}),L.Polyline.include({__toGeoJSON:function(){if(!this._map)return;let t=L.Polyline.prototype.toGeoJSON.call(this);return t.properties={type:"polyline",label:this.options.label,dashed:!!this.options.dashArray,color:this.options.color,thickness:this.options.weight,transparency:1-this.options.opacity},t}}),L.Polygon.include({__toGeoJSON:function(){if(!this._map)return;let t=L.Polygon.prototype.toGeoJSON.call(this);return t.properties={type:this instanceof L.Rectangle?"rectangle":"polygon",label:this.options.label,dashed:!!this.options.dashArray,lineColor:this.options.color,lineThickness:this.options.weight,lineTransparency:1-this.options.opacity,fillColor:this.options.fillColor,fillTransparency:1-this.options.fillOpacity},t}}),L.Circle.include({__toGeoJSON:function(){if(!this._map)return;let t=L.Circle.prototype.toGeoJSON.call(this);return t.properties={type:"circle",radius:this.getRadius(),label:this.options.label,dashed:!!this.options.dashArray,lineColor:this.options.color,lineThickness:this.options.weight,lineTransparency:1-this.options.opacity,fillColor:this.options.fillColor,fillTransparency:1-this.options.fillOpacity},t}})})),parcelRequire("Wc23C")})();
//# sourceMappingURL=main_edit_1666621876.js.map
